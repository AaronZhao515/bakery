# äº‘å‡½æ•°éƒ¨ç½²è„šæœ¬

æš–å¿ƒçƒ˜ç„™å°ç¨‹åºçš„äº‘å‡½æ•°éƒ¨ç½²å·¥å…·é›†åˆã€‚

## æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | ç”¨é€” | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `deploy-functions.js` | Node.js éƒ¨ç½²è„šæœ¬ | æ‰‹åŠ¨éƒ¨ç½²ï¼Œæ”¯æŒäº¤äº’å¼ç¡®è®¤ |
| `deploy-batch.ps1` | PowerShell æ‰¹é‡éƒ¨ç½² | Windows ç¯å¢ƒæ‰¹é‡éƒ¨ç½² |
| `deploy-ci.sh` | Bash CI/CD è„šæœ¬ | Linux/Mac/CI ç¯å¢ƒ |
| `deploy.bat` | Windows æ‰¹å¤„ç† | Windows å¿«é€Ÿéƒ¨ç½² |

## å¿«é€Ÿå¼€å§‹

### 1. æŸ¥çœ‹æ‰€æœ‰äº‘å‡½æ•°

```bash
# Node.js è„šæœ¬
node scripts/deploy-functions.js --list

# PowerShell
.\scripts\deploy-batch.ps1 -Environment development

# Windows æ‰¹å¤„ç†
scripts\deploy.bat --list
```

### 2. éƒ¨ç½²æŒ‡å®šäº‘å‡½æ•°

```bash
# éƒ¨ç½²å•ä¸ªäº‘å‡½æ•°
node scripts/deploy-functions.js product

# éƒ¨ç½²å¤šä¸ªäº‘å‡½æ•°
node scripts/deploy-functions.js product cart order
```

### 3. éƒ¨ç½²æ‰€æœ‰äº‘å‡½æ•°

```bash
# äº¤äº’å¼éƒ¨ç½²ï¼ˆä¼šæç¤ºç¡®è®¤ï¼‰
node scripts/deploy-functions.js --all

# PowerShell
.\scripts\deploy-batch.ps1
```

## å…³é”®äº‘å‡½æ•°

ä»¥ä¸‹äº‘å‡½æ•°æ¶‰åŠæ ¸å¿ƒä¸šåŠ¡ï¼Œéƒ¨ç½²æ—¶ä¼šé¢å¤–ç¡®è®¤ï¼š

| äº‘å‡½æ•° | è¯´æ˜ | é£é™©ç­‰çº§ |
|--------|------|----------|
| `pay` | å¾®ä¿¡æ”¯ä»˜æœåŠ¡ | ğŸ”´ é«˜ |
| `payCallback` | æ”¯ä»˜å›è°ƒå¤„ç† | ğŸ”´ é«˜ |
| `createOrder` | åˆ›å»ºè®¢å• | ğŸŸ  ä¸­ |
| `admin` | ç®¡ç†åå° | ğŸŸ  ä¸­ |

## éƒ¨ç½²æ–¹å¼å¯¹æ¯”

### æ–¹å¼ä¸€ï¼šæ ‡å‡†éƒ¨ç½²ï¼ˆæ¨èï¼‰

ä½¿ç”¨ Node.js è„šæœ¬ï¼Œæ”¯æŒäº¤äº’å¼ç¡®è®¤ï¼š

```bash
node scripts/deploy-functions.js --all
```

ç‰¹ç‚¹ï¼š
- âœ… å…³é”®å‡½æ•°ä¼šæç¤ºç¡®è®¤
- âœ… éƒ¨ç½²é¡ºåºä¼˜åŒ–
- âœ… æ˜¾ç¤ºè¯¦ç»†ç»“æœ

### æ–¹å¼äºŒï¼šå¼ºåˆ¶éƒ¨ç½²ï¼ˆCI/CDï¼‰

ä½¿ç”¨ `--force` å‚æ•°ï¼Œè·³è¿‡æ‰€æœ‰ç¡®è®¤ï¼š

```bash
node scripts/deploy-functions.js --all --force
```

âš ï¸ **è­¦å‘Š**ï¼šç”Ÿäº§ç¯å¢ƒè¯·è°¨æ…ä½¿ç”¨ï¼

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨ Claude Code éƒ¨ç½²

é€šè¿‡ Claude Code çš„ MCP å·¥å…·éƒ¨ç½²ï¼š

```bash
# æ ‡å‡†æ¨¡å¼ï¼ˆæœ‰ç¡®è®¤ï¼‰
claude -p "Deploy cloud functions: product, cart, order"

# å¼ºåˆ¶æ¨¡å¼ï¼ˆæ— ç¡®è®¤ï¼‰
claude --dangerously-permission-skip -p "Deploy all cloud functions"
```

## CI/CD é›†æˆ

### GitHub Actions

```yaml
# .github/workflows/deploy.yml
name: Deploy Cloud Functions

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Deploy Cloud Functions
        run: node scripts/deploy-functions.js --all --force
        env:
          DEPLOY_ENV: production
```

### æ‰‹åŠ¨è§¦å‘éƒ¨ç½²

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export DEPLOY_ENV=production
export SKIP_CONFIRMATION=true

# æ‰§è¡Œéƒ¨ç½²
bash scripts/deploy-ci.sh
```

## äº‘å‡½æ•°åˆ—è¡¨

å½“å‰é¡¹ç›®å…±æœ‰ **16** ä¸ªäº‘å‡½æ•°ï¼š

### åŸºç¡€æœåŠ¡
| åºå· | äº‘å‡½æ•° | è¯´æ˜ |
|------|--------|------|
| 1 | `user` | ç”¨æˆ·æœåŠ¡ |
| 2 | `address` | åœ°å€ç®¡ç† |
| 3 | `product` | å•†å“ç®¡ç† |

### ä¸šåŠ¡æœåŠ¡
| åºå· | äº‘å‡½æ•° | è¯´æ˜ |
|------|--------|------|
| 4 | `cart` | è´­ç‰©è½¦ |
| 5 | `coupon` | ä¼˜æƒ åˆ¸ |
| 6 | `points` | ç§¯åˆ†ç³»ç»Ÿ |

### æŸ¥è¯¢æœåŠ¡
| åºå· | äº‘å‡½æ•° | è¯´æ˜ |
|------|--------|------|
| 7 | `getProducts` | è·å–å•†å“åˆ—è¡¨ |
| 8 | `getProductDetail` | å•†å“è¯¦æƒ… |
| 9 | `getHomeData` | é¦–é¡µæ•°æ® |
| 10 | `checkStock` | åº“å­˜æ£€æŸ¥ |
| 11 | `checkPayStatus` | æ”¯ä»˜çŠ¶æ€æ£€æŸ¥ |

### æ ¸å¿ƒä¸šåŠ¡
| åºå· | äº‘å‡½æ•° | è¯´æ˜ | å…³é”® |
|------|--------|------|------|
| 12 | `createOrder` | åˆ›å»ºè®¢å• | âš ï¸ |
| 13 | `order` | è®¢å•ç®¡ç† | |
| 14 | `pay` | æ”¯ä»˜æœåŠ¡ | âš ï¸ |
| 15 | `payCallback` | æ”¯ä»˜å›è°ƒ | âš ï¸ |
| 16 | `admin` | ç®¡ç†æœåŠ¡ | âš ï¸ |

## éƒ¨ç½²é¡ºåº

è„šæœ¬ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºéƒ¨ç½²ï¼Œç¡®ä¿ä¾èµ–å…³ç³»æ­£ç¡®ï¼š

```
user â†’ address â†’ product â†’ cart â†’ coupon â†’ points
     â†’ getProducts â†’ getProductDetail â†’ getHomeData
     â†’ checkStock â†’ checkPayStatus
     â†’ createOrder â†’ order â†’ pay â†’ payCallback â†’ admin
```

## å®‰å…¨å»ºè®®

### å¼€å‘ç¯å¢ƒ
- ä½¿ç”¨æ ‡å‡†éƒ¨ç½²æ¨¡å¼
- å¯ä»¥è‡ªç”±æµ‹è¯•å’Œéƒ¨ç½²

### æµ‹è¯•ç¯å¢ƒ
- å»ºè®®ä½¿ç”¨ `--dry-run` é¢„è§ˆéƒ¨ç½²
- å…³é”®å‡½æ•°ä»éœ€ç¡®è®¤

### ç”Ÿäº§ç¯å¢ƒ
- å¿…é¡»ä»£ç å®¡æŸ¥åæ‰èƒ½éƒ¨ç½²
- å…³é”®å‡½æ•°éœ€è¦åŒäººç¡®è®¤
- å»ºè®®å…ˆéƒ¨ç½²åˆ°é¢„å‘å¸ƒç¯å¢ƒéªŒè¯
- ä¿ç•™å›æ»šæ–¹æ¡ˆ

## å¸¸è§é—®é¢˜

### Q: éƒ¨ç½²å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. äº‘å‡½æ•°ç›®å½•æ˜¯å¦å­˜åœ¨ `index.js`
2. ä»£ç è¯­æ³•æ˜¯å¦æ­£ç¡®
3. äº‘å¼€å‘ç¯å¢ƒæ˜¯å¦æ­£å¸¸
4. æƒé™æ˜¯å¦è¶³å¤Ÿ

### Q: å¦‚ä½•å›æ»šï¼Ÿ

A: äº‘å‡½æ•°ä¸æ”¯æŒè‡ªåŠ¨å›æ»šï¼Œå»ºè®®ï¼š
1. éƒ¨ç½²å‰ä¿å­˜ä»£ç ç‰ˆæœ¬ï¼ˆGitï¼‰
2. å‡ºç°é—®é¢˜æ—¶ä» Git æ£€å‡ºæ—§ç‰ˆæœ¬é‡æ–°éƒ¨ç½²
3. å…³é”®ä¸šåŠ¡å»ºè®®è“ç»¿éƒ¨ç½²

### Q: éƒ¨ç½²åéœ€è¦åšä»€ä¹ˆï¼Ÿ

A: åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š
1. å³é”®äº‘å‡½æ•°æ–‡ä»¶å¤¹
2. é€‰æ‹©ã€Œåˆ›å»ºå¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–ã€
3. ç­‰å¾…éƒ¨ç½²å®Œæˆ

## æ³¨æ„äº‹é¡¹

1. **ä¸è¦ç›´æ¥ä¿®æ”¹çº¿ä¸Šç¯å¢ƒ** - å…ˆåœ¨å¼€å‘/æµ‹è¯•ç¯å¢ƒéªŒè¯
2. **å…³é”®å‡½æ•°è°¨æ…éƒ¨ç½²** - pay/payCallback ç­‰å‡½æ•°å½±å“æ”¯ä»˜
3. **ä¿æŒä»£ç ç‰ˆæœ¬** - ä½¿ç”¨ Git ç®¡ç†ä»£ç ï¼Œä¾¿äºå›æ»š
4. **ç›‘æ§éƒ¨ç½²ç»“æœ** - éƒ¨ç½²åæ£€æŸ¥äº‘å‡½æ•°æ—¥å¿—

## `--dangerously-permission-skip` å‚æ•°è¯´æ˜

è¿™æ˜¯ Claude Code çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äº**è·³è¿‡æ‰€æœ‰æƒé™æ£€æŸ¥**ï¼Œå®ç°æ— äº¤äº’è‡ªåŠ¨éƒ¨ç½²ã€‚

### ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | æ˜¯å¦æ¨è | è¯´æ˜ |
|------|----------|------|
| CI/CD è‡ªåŠ¨åŒ– | âœ… æ¨è | æµæ°´çº¿ä¸­éœ€è¦æ— äº¤äº’éƒ¨ç½² |
| å¼€å‘ç¯å¢ƒæµ‹è¯• | âš ï¸ è°¨æ… | å¿«é€Ÿè¿­ä»£ä½†éœ€æ¥å—é£é™© |
| ç”Ÿäº§ç¯å¢ƒæ‰‹åŠ¨ | âŒ ä¸æ¨è | åº”æœ‰ç¡®è®¤æœºåˆ¶ |

### ä½¿ç”¨æ–¹æ³•

```bash
# åŸºæœ¬ç”¨æ³•
claude --dangerously-permission-skip

# ç®€å†™å½¢å¼
claude -d

# å¸¦éƒ¨ç½²æŒ‡ä»¤
claude --dangerously-permission-skip -p "Deploy all cloud functions"
```

### é£é™©è­¦å‘Š

âš ï¸ **ä½¿ç”¨æ­¤å‚æ•°å­˜åœ¨é‡å¤§é£é™©**ï¼š

1. **æ•°æ®ä¸¢å¤±é£é™©** - å¯èƒ½æ„å¤–è¦†ç›–ç”Ÿäº§ç¯å¢ƒäº‘å‡½æ•°
2. **æœåŠ¡ä¸­æ–­é£é™©** - å…³é”®å‡½æ•°ï¼ˆå¦‚ payï¼‰éƒ¨ç½²é”™è¯¯ä¼šå¯¼è‡´æ”¯ä»˜å¤±è´¥
3. **ä¸å¯é€†æ“ä½œ** - äº‘å‡½æ•°ä¸€æ—¦è¦†ç›–ï¼Œæ— æ³•è‡ªåŠ¨å›æ»š
4. **æ— ç¡®è®¤æç¤º** - å…³é”®å‡½æ•°éƒ¨ç½²ä¹Ÿä¸ä¼šæç¤ºç¡®è®¤

### å®‰å…¨ä½¿ç”¨å»ºè®®

```bash
# âŒ å±é™©ï¼šç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨
claude --dangerously-permission-skip -p "Deploy all cloud functions"

# âœ… å®‰å…¨ï¼šä»…åœ¨ CI ç¯å¢ƒä½¿ç”¨
# åœ¨ .github/workflows/deploy.yml ä¸­:
# - name: Deploy
#   run: claude --dangerously-permission-skip -p "Deploy functions"
#   env:
#     DEPLOY_ENV: production  # ç¯å¢ƒå˜é‡æ§åˆ¶
```

### é˜²æŠ¤æœºåˆ¶

å³ä½¿ä½¿ç”¨ `--dangerously-permission-skip`ï¼Œä»å»ºè®®ï¼š

1. **ç¯å¢ƒéš”ç¦»** - å¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒåˆ†ç¦»
2. **Git ç‰ˆæœ¬æ§åˆ¶** - æ‰€æœ‰ä»£ç å˜æ›´é€šè¿‡ Git ç®¡ç†
3. **é¢„å‘å¸ƒéªŒè¯** - éƒ¨ç½²å‰åœ¨ staging ç¯å¢ƒéªŒè¯
4. **ç›‘æ§å‘Šè­¦** - éƒ¨ç½²åç›‘æ§é”™è¯¯æ—¥å¿—

---

## å¿«é€Ÿä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šæŸ¥çœ‹æ‰€æœ‰äº‘å‡½æ•°

```bash
$ node scripts/deploy-functions.js --list

ğŸ“‹ æ‰€æœ‰äº‘å‡½æ•° (16ä¸ª):

  [1] user
  [2] address
  [3] product
  ...
  [12] createOrder âš ï¸
  [14] pay âš ï¸
  [15] payCallback âš ï¸
  [16] admin âš ï¸

å…³é”®äº‘å‡½æ•°: pay, payCallback, createOrder, admin
```

### ç¤ºä¾‹ 2ï¼šæ ‡å‡†éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# éƒ¨ç½²æŒ‡å®šäº‘å‡½æ•°
$ node scripts/deploy-functions.js product cart order

ğŸ“¦ éƒ¨ç½²äº‘å‡½æ•°: product
   è·¯å¾„: D:\bread-bakery-miniprogram\cloudfunctions
   âœ… product éƒ¨ç½²å®Œæˆ

ğŸ“¦ éƒ¨ç½²äº‘å‡½æ•°: cart
   âœ… cart éƒ¨ç½²å®Œæˆ

ğŸ“¦ éƒ¨ç½²äº‘å‡½æ•°: order
   âœ… order éƒ¨ç½²å®Œæˆ
```

### ç¤ºä¾‹ 3ï¼šéƒ¨ç½²æ‰€æœ‰äº‘å‡½æ•°ï¼ˆäº¤äº’å¼ï¼‰

```bash
$ node scripts/deploy-functions.js --all

============================================================
ğŸ“‹ éƒ¨ç½²è®¡åˆ’
============================================================
æ¨¡å¼: æ ‡å‡†éƒ¨ç½²
äº‘å‡½æ•°æ•°é‡: 16
éƒ¨ç½²é¡ºåº: user â†’ address â†’ product â†’ ... â†’ pay â†’ admin

âš ï¸  æ³¨æ„: å°†éƒ¨ç½² 4 ä¸ªå…³é”®äº‘å‡½æ•°:
   - pay
   - payCallback
   - createOrder
   - admin

============================================================

ç¡®è®¤éƒ¨ç½²ä»¥ä¸Šäº‘å‡½æ•°å—ï¼Ÿ (y/N): y

ğŸš€ å¼€å§‹éƒ¨ç½²...
```

### ç¤ºä¾‹ 4ï¼šå¼ºåˆ¶éƒ¨ç½²ï¼ˆCI/CDï¼‰

```bash
# âš ï¸ å±é™©ï¼šè·³è¿‡æ‰€æœ‰ç¡®è®¤
$ node scripts/deploy-functions.js --all --force

============================================================
ğŸ“‹ éƒ¨ç½²è®¡åˆ’
============================================================
æ¨¡å¼: å¼ºåˆ¶éƒ¨ç½²
äº‘å‡½æ•°æ•°é‡: 16
...
============================================================

ğŸš€ å¼€å§‹éƒ¨ç½²...
# ç›´æ¥éƒ¨ç½²ï¼Œä¸æç¤ºç¡®è®¤
```

### ç¤ºä¾‹ 5ï¼šä½¿ç”¨ Claude Code éƒ¨ç½²

```bash
# æ ‡å‡†æ¨¡å¼ï¼ˆå…³é”®å‡½æ•°ä¼šæç¤ºç¡®è®¤ï¼‰
$ claude -p "Deploy cloud functions: product, cart"

Claude: æˆ‘å°†ä¸ºæ‚¨éƒ¨ç½²ä»¥ä¸‹äº‘å‡½æ•°ï¼šproduct, cart
ç¡®è®¤éƒ¨ç½²å—ï¼Ÿ (y/N): y
æ­£åœ¨éƒ¨ç½²...

# å¼ºåˆ¶æ¨¡å¼ï¼ˆä½¿ç”¨ --dangerously-permission-skipï¼‰
$ claude --dangerously-permission-skip -p "Deploy all cloud functions"

# ç›´æ¥æ‰§è¡Œï¼Œä¸æç¤ºä»»ä½•ç¡®è®¤
```

---

## è”ç³»æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- é¡¹ç›®æ–‡æ¡£ï¼š`CLAUDE.md`
- æ¶æ„æ–‡æ¡£ï¼š`ARCHITECTURE.md`
- å¾®ä¿¡äº‘å¼€å‘æ–‡æ¡£ï¼šhttps://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html
