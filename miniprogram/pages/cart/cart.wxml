<!-- 购物车页面 -->
<view class="cart-container">
  <!-- 空购物车状态 -->
  <view class="empty-cart" wx:if="{{cartList.length === 0}}">
    <image class="empty-icon" src="/images/cart-empty.png" mode="aspectFit"/>
    <text class="empty-text">购物车空空如也</text>
    <text class="empty-subtext">快去挑选心仪的面包吧~</text>
    <button class="go-shopping-btn" bindtap="goToShop">去逛逛</button>
  </view>

  <!-- 购物车列表 -->
  <view class="cart-content" wx:else>
    <!-- 店铺信息 -->
    <view class="shop-header">
      <view class="shop-select" bindtap="toggleSelectAll">
        <view class="checkbox {{isAllSelected ? 'checked' : ''}}">
          <text class="check-icon" wx:if="{{isAllSelected}}">✓</text>
        </view>
        <text class="shop-name">温馨烘焙坊</text>
      </view>
    </view>

    <!-- 商品列表 -->
    <scroll-view class="cart-list" scroll-y enhanced show-scrollbar="{{false}}">
      <view 
        class="cart-item" 
        wx:for="{{cartList}}" 
        wx:key="_id"
        bindtouchstart="touchStart"
        bindtouchend="touchEnd"
        data-index="{{index}}"
        style="transform: translateX({{item.slideX || 0}}rpx);"
      >
        <!-- 商品选择 -->
        <view class="item-select" catchtap="toggleItemSelect" data-index="{{index}}">
          <view class="checkbox {{item.selected ? 'checked' : ''}}">
            <text class="check-icon" wx:if="{{item.selected}}">✓</text>
          </view>
        </view>

        <!-- 商品图片 -->
        <image class="item-image" src="{{item.imageUrl}}" mode="aspectFill" lazy-load/>

        <!-- 商品信息 -->
        <view class="item-info">
          <text class="item-name">{{item.name}}</text>
          <text class="item-spec" wx:if="{{item.spec}}">{{item.spec}}</text>
          <view class="item-bottom">
            <text class="item-price">¥{{item.price}}</text>
            <!-- 数量调整 -->
            <view class="quantity-control">
              <view 
                class="quantity-btn minus {{item.quantity <= 1 ? 'disabled' : ''}}" 
                catchtap="decreaseQuantity"
                data-index="{{index}}"
              >-</view>
              <input 
                class="quantity-input" 
                type="number" 
                value="{{item.quantity}}"
                bindblur="onQuantityInput"
                data-index="{{index}}"
              />
              <view 
                class="quantity-btn plus {{item.quantity >= item.stock ? 'disabled' : ''}}" 
                catchtap="increaseQuantity"
                data-index="{{index}}"
              >+</view>
            </view>
          </view>
          <!-- 库存提示 -->
          <text class="stock-tip" wx:if="{{item.quantity >= item.stock}}">库存不足</text>
        </view>

        <!-- 删除按钮 -->
        <view class="delete-btn" catchtap="deleteItem" data-index="{{index}}">
          <text>删除</text>
        </view>
      </view>
    </scroll-view>

    <!-- 底部立即预定栏 -->
    <view class="cart-footer">
      <view class="footer-select" bindtap="toggleSelectAll">
        <view class="checkbox {{isAllSelected ? 'checked' : ''}}">
          <text class="check-icon" wx:if="{{isAllSelected}}">✓</text>
        </view>
        <text class="select-all-text">全选</text>
      </view>
      <view class="footer-info">
        <view class="total-price">
          <text class="total-label">合计:</text>
          <text class="price-symbol">¥</text>
          <text class="price-value">{{totalPrice}}</text>
        </view>
        <text class="discount-info" wx:if="{{discount > 0}}">已优惠¥{{discount}}</text>
      </view>
      <view
        class="checkout-btn {{selectedCount === 0 ? 'disabled' : ''}}"
        bindtap="goToCheckout"
      >
        <text class="checkout-text">立即预定</text>
        <text class="checkout-count" wx:if="{{selectedCount > 0}}">({{selectedCount}})</text>
      </view>
    </view>
  </view>

  <!-- 猜你喜欢 -->
  <view class="recommend-section" wx:if="{{recommendList.length > 0}}">
    <view class="section-title">
      <view class="title-line"></view>
      <text>猜你喜欢</text>
      <view class="title-line"></view>
    </view>
    <view class="recommend-list">
      <view class="recommend-item" wx:for="{{recommendList}}" wx:key="_id" bindtap="goToProduct" data-id="{{item._id}}">
        <image class="recommend-image" src="{{item.imageUrl}}" mode="aspectFill"/>
        <text class="recommend-name">{{item.name}}</text>
        <text class="recommend-price">¥{{item.price}}</text>
      </view>
    </view>
  </view>
</view>

<!-- 删除确认弹窗 -->
<view class="modal-mask" wx:if="{{showDeleteModal}}" bindtap="cancelDelete"></view>
<view class="modal-content" wx:if="{{showDeleteModal}}">
  <view class="modal-header">
    <text>确认删除</text>
  </view>
  <view class="modal-body">
    <text>确定要从购物车删除该商品吗？</text>
  </view>
  <view class="modal-footer">
    <button class="modal-btn cancel" bindtap="cancelDelete">取消</button>
    <button class="modal-btn confirm" bindtap="confirmDelete">确定</button>
  </view>
</view>
