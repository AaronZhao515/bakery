<!-- 订单列表页 -->
<view class="container">
  <!-- 状态筛选栏 -->
  <view class="filter-bar">
    <scroll-view scroll-x class="filter-scroll" scroll-with-animation>
      <view class="filter-list">
        <view 
          class="filter-item {{currentStatus === -1 ? 'active' : ''}}" 
          data-status="-1"
          bindtap="onStatusChange"
        >
          <text class="filter-text">全部</text>
        </view>
        <view 
          class="filter-item {{currentStatus === 0 ? 'active' : ''}}" 
          data-status="0"
          bindtap="onStatusChange"
        >
          <text class="filter-text">待付款</text>
          <text class="badge" wx:if="{{statusCounts[0] > 0}}">{{statusCounts[0]}}</text>
        </view>
        <view 
          class="filter-item {{currentStatus === 1 ? 'active' : ''}}" 
          data-status="1"
          bindtap="onStatusChange"
        >
          <text class="filter-text">待发货</text>
          <text class="badge" wx:if="{{statusCounts[1] > 0}}">{{statusCounts[1]}}</text>
        </view>
        <view 
          class="filter-item {{currentStatus === 2 ? 'active' : ''}}" 
          data-status="2"
          bindtap="onStatusChange"
        >
          <text class="filter-text">待收货</text>
          <text class="badge" wx:if="{{statusCounts[2] > 0}}">{{statusCounts[2]}}</text>
        </view>
        <view 
          class="filter-item {{currentStatus === 3 ? 'active' : ''}}" 
          data-status="3"
          bindtap="onStatusChange"
        >
          <text class="filter-text">已完成</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 订单列表 -->
  <view class="order-list">
    <block wx:if="{{orderList.length > 0}}">
      <view 
        class="order-card" 
        wx:for="{{orderList}}" 
        wx:key="_id"
        data-id="{{item._id}}"
        bindtap="goToDetail"
      >
        <!-- 订单头部 -->
        <view class="order-header">
          <view class="order-info">
            <text class="order-no">订单号：{{item.orderNo}}</text>
            <text class="order-time">{{item.createTime}}</text>
          </view>
          <text class="order-status {{'status-' + item.status}}">{{item.statusText}}</text>
        </view>

        <!-- 商品列表 -->
        <view class="goods-list">
          <view class="goods-item" wx:for="{{item.goodsList}}" wx:for-item="goods" wx:key="id">
            <image class="goods-image" src="{{goods.image}}" mode="aspectFill"/>
            <view class="goods-info">
              <text class="goods-name">{{goods.name}}</text>
              <text class="goods-spec" wx:if="{{goods.spec}}">{{goods.spec}}</text>
            </view>
            <view class="goods-price">
              <text class="price">¥{{goods.price}}</text>
              <text class="count">x{{goods.count}}</text>
            </view>
          </view>
        </view>

        <!-- 订单金额 -->
        <view class="order-amount">
          <text class="amount-label">共{{item.totalCount}}件商品</text>
          <text class="amount-text">合计：</text>
          <text class="amount-value">¥{{item.totalAmount}}</text>
        </view>

        <!-- 操作按钮 -->
        <view class="order-actions">
          <!-- 待付款 -->
          <block wx:if="{{item.status === 0}}">
            <button class="btn btn-default" data-id="{{item._id}}" catchtap="cancelOrder">取消订单</button>
            <button class="btn btn-primary" data-id="{{item._id}}" data-amount="{{item.totalAmount}}" catchtap="payOrder">立即付款</button>
          </block>
          
          <!-- 待发货 -->
          <block wx:if="{{item.status === 1}}">
            <button class="btn btn-default" data-id="{{item._id}}" catchtap="applyRefund">申请退款</button>
            <button class="btn btn-default" data-id="{{item._id}}" catchtap="remindDelivery">提醒发货</button>
          </block>
          
          <!-- 待收货 -->
          <block wx:if="{{item.status === 2}}">
            <button class="btn btn-default" data-id="{{item._id}}" catchtap="viewLogistics">查看物流</button>
            <button class="btn btn-primary" data-id="{{item._id}}" catchtap="confirmReceive">确认收货</button>
          </block>
          
          <!-- 已完成 -->
          <block wx:if="{{item.status === 3}}">
            <button class="btn btn-default" data-id="{{item._id}}" catchtap="deleteOrder">删除订单</button>
            <button class="btn btn-default" data-id="{{item._id}}" catchtap="buyAgain">再次购买</button>
            <button class="btn btn-primary" data-id="{{item._id}}" catchtap="goToReview" wx:if="{{!item.isReviewed}}">评价</button>
          </block>
          
          <!-- 已取消/已退款 -->
          <block wx:if="{{item.status === 4 || item.status === 6}}">
            <button class="btn btn-default" data-id="{{item._id}}" catchtap="deleteOrder">删除订单</button>
            <button class="btn btn-default" data-id="{{item._id}}" catchtap="buyAgain">再次购买</button>
          </block>
          
          <!-- 退款中 -->
          <block wx:if="{{item.status === 5}}">
            <button class="btn btn-default" data-id="{{item._id}}" catchtap="viewRefund">查看退款</button>
          </block>
        </view>
      </view>

      <!-- 加载更多 -->
      <view class="load-more">
        <text wx:if="{{isLoading}}">加载中...</text>
        <text wx:elif="{{!hasMore}}">没有更多了</text>
      </view>
    </block>

    <!-- 空状态 -->
    <view class="empty-state" wx:else>
      <image class="empty-image" src="/images/empty-order.png" mode="aspectFit"/>
      <text class="empty-text">暂无订单</text>
      <text class="empty-subtext">快去选购心仪的面包吧~</text>
      <button class="btn btn-primary empty-btn" bindtap="goToShop">去逛逛</button>
    </view>
  </view>
</view>
