<!-- 优惠券页 -->
<view class="container">
  <!-- 状态筛选 -->
  <view class="filter-bar">
    <view 
      class="filter-item {{currentTab === 0 ? 'active' : ''}}" 
      data-tab="0"
      bindtap="switchTab"
    >
      <text class="filter-text">未使用</text>
      <text class="filter-count" wx:if="{{counts.unused > 0}}">({{counts.unused}})</text>
    </view>
    <view 
      class="filter-item {{currentTab === 1 ? 'active' : ''}}" 
      data-tab="1"
      bindtap="switchTab"
    >
      <text class="filter-text">已使用</text>
    </view>
    <view 
      class="filter-item {{currentTab === 2 ? 'active' : ''}}" 
      data-tab="2"
      bindtap="switchTab"
    >
      <text class="filter-text">已过期</text>
    </view>
  </view>

  <!-- 优惠券列表 -->
  <view class="coupon-list">
    <block wx:if="{{couponList.length > 0}}">
      <view 
        class="coupon-card {{item.status !== 0 ? 'disabled' : ''}} {{item.isExpiringSoon ? 'expiring' : ''}}" 
        wx:for="{{couponList}}" 
        wx:key="_id"
      >
        <!-- 左侧金额区 -->
        <view class="coupon-left">
          <view class="coupon-amount">
            <text class="amount-symbol">¥</text>
            <text class="amount-value">{{item.amount}}</text>
          </view>
          <text class="coupon-condition">满{{item.minSpend}}元可用</text>
        </view>

        <!-- 中间分隔线 -->
        <view class="coupon-divider">
          <view class="divider-dot top"></view>
          <view class="divider-line"></view>
          <view class="divider-dot bottom"></view>
        </view>

        <!-- 右侧信息区 -->
        <view class="coupon-right">
          <view class="coupon-info">
            <text class="coupon-name">{{item.name}}</text>
            <text class="coupon-scope">{{item.scope}}</text>
            <text class="coupon-time">有效期至 {{item.expireTime}}</text>
          </view>
          
          <!-- 状态标签 -->
          <view class="coupon-status">
            <text class="status-tag used" wx:if="{{item.status === 1}}">已使用</text>
            <text class="status-tag expired" wx:if="{{item.status === 2}}">已过期</text>
            <text class="status-tag expiring" wx:if="{{item.status === 0 && item.isExpiringSoon}}">即将过期</text>
            <button 
              class="use-btn" 
              wx:if="{{item.status === 0}}"
              data-id="{{item._id}}"
              bindtap="useCoupon"
            >
              去使用
            </button>
          </view>
        </view>
      </view>

      <!-- 加载更多 -->
      <view class="load-more" wx:if="{{!isLoading && hasMore}}">
        <text bindtap="loadMore">加载更多</text>
      </view>
    </block>

    <!-- 空状态 -->
    <view class="empty-state" wx:else>
      <image class="empty-image" src="/images/empty-coupon.png" mode="aspectFit"/>
      <text class="empty-text">暂无{{tabText[currentTab]}}优惠券</text>
      <text class="empty-subtext" wx:if="{{currentTab === 0}}">快去领取更多优惠吧~</text>
      <button class="btn btn-primary empty-btn" wx:if="{{currentTab === 0}}" bindtap="goToGetCoupon">
        去领券中心
      </button>
    </view>
  </view>

  <!-- 兑换码输入区 -->
  <view class="exchange-section" wx:if="{{currentTab === 0}}">
    <view class="exchange-input-wrapper">
      <input 
        class="exchange-input" 
        type="text" 
        placeholder="请输入兑换码"
        value="{{exchangeCode}}"
        bindinput="onExchangeInput"
        maxlength="20"
      />
      <button class="exchange-btn {{exchangeCode ? 'active' : ''}}" bindtap="exchangeCoupon">
        兑换
      </button>
    </view>
  </view>
</view>
