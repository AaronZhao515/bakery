<!-- å•†å“åˆ†ç±»é¡µ -->
<view class="category-container">
  <!-- æœç´¢æ  -->
  <view class="search-header">
    <view class="search-bar" bindtap="onSearchTap">
      <text class="search-icon">ğŸ”</text>
      <text class="search-placeholder">æœç´¢å•†å“</text>
    </view>
  </view>

  <!-- åˆ†ç±»å†…å®¹åŒº -->
  <view class="category-content">
    <!-- å·¦ä¾§åˆ†ç±»å¯¼èˆª -->
    <scroll-view class="category-nav" scroll-y="{{true}}" scroll-with-animation="{{true}}" scroll-into-view="nav-{{activeCategory}}">
      <view class="nav-item {{activeCategory === item.id ? 'active' : ''}}" wx:for="{{categories}}" wx:key="id" id="nav-{{item.id}}" bindtap="onCategoryTap" data-id="{{item.id}}">
        <view class="nav-indicator"></view>
        <text class="nav-name">{{item.name}}</text>
        <text wx:if="{{item.count > 0}}" class="nav-count">{{item.count}}</text>
      </view>
    </scroll-view>

    <!-- å³ä¾§å•†å“åˆ—è¡¨ -->
    <scroll-view class="product-content" scroll-y="{{true}}" scroll-top="{{scrollTop}}" bindscroll="onProductScroll" bindscrolltolower="onLoadMore">
      <!-- åˆ†ç±»æ¨ªå¹… -->
      <view class="category-banner" wx:if="{{currentCategory}}">
        <image class="banner-image" src="{{currentCategory.banner}}" mode="aspectFill" />
        <view class="banner-overlay">
          <text class="banner-name">{{currentCategory.name}}</text>
          <text class="banner-desc">{{currentCategory.description}}</text>
        </view>
      </view>

      <!-- å­åˆ†ç±»æ ‡ç­¾ -->
      <view class="sub-category-section" wx:if="{{currentCategory && currentCategory.children && currentCategory.children.length > 0}}">
        <scroll-view class="sub-category-scroll" scroll-x="{{true}}">
          <view class="sub-category-list">
            <view class="sub-category-item {{activeSubCategory === 'all' ? 'active' : ''}}" bindtap="onSubCategoryTap" data-id="all">
              <text>å…¨éƒ¨</text>
            </view>
            <view class="sub-category-item {{activeSubCategory === item.id ? 'active' : ''}}" wx:for="{{currentCategory.children}}" wx:key="id" bindtap="onSubCategoryTap" data-id="{{item.id}}">
              <text>{{item.name}}</text>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- æ’åºç­›é€‰ -->
      <view class="sort-section">
        <view class="sort-item {{sortType === 'default' ? 'active' : ''}}" bindtap="onSortTap" data-type="default">
          <text>ç»¼åˆ</text>
        </view>
        <view class="sort-item {{sortType === 'sales' ? 'active' : ''}}" bindtap="onSortTap" data-type="sales">
          <text>é”€é‡</text>
          <text class="sort-arrow">{{sortType === 'sales' ? 'â†“' : ''}}</text>
        </view>
        <view class="sort-item {{sortType === 'price' ? 'active' : ''}}" bindtap="onSortTap" data-type="price">
          <text>ä»·æ ¼</text>
          <text class="sort-arrow">{{priceSort === 'asc' ? 'â†‘' : (priceSort === 'desc' ? 'â†“' : '')}}</text>
        </view>
        <view class="sort-item {{sortType === 'new' ? 'active' : ''}}" bindtap="onSortTap" data-type="new">
          <text>æ–°å“</text>
        </view>
      </view>

      <!-- å•†å“ç½‘æ ¼ -->
      <view class="product-grid">
        <view class="product-item" wx:for="{{products}}" wx:key="id" bindtap="onProductTap" data-id="{{item.id}}">
          <view class="product-image-wrapper">
            <image class="product-image" src="{{item.image}}" mode="aspectFill" lazy-load="{{true}}" />
            <view class="product-badge" wx:if="{{item.badge}}" style="background: {{item.badgeColor}};">{{item.badge}}</view>
          </view>
          <view class="product-info">
            <text class="product-name">{{item.name}}</text>
            <text class="product-desc">{{item.description}}</text>
            <view class="product-meta">
              <text class="product-sales">æœˆé”€ {{item.sales}}</text>
              <view class="product-rating" wx:if="{{item.rating}}">
                <text class="rating-star">â˜…</text>
                <text class="rating-score">{{item.rating}}</text>
              </view>
            </view>
            <view class="product-bottom">
              <view class="product-price">
                <text class="price price-medium">{{item.price}}</text>
                <text wx:if="{{item.originalPrice}}" class="original-price">{{item.originalPrice}}</text>
              </view>
              <view class="add-cart-btn" catchtap="onAddCart" data-item="{{item}}">
                <text class="cart-icon">ğŸ›’</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{loading}}">
        <view class="loading-spinner"></view>
        <text>åŠ è½½ä¸­...</text>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{!loading && products.length === 0}}">
        <text class="empty-icon">ğŸ</text>
        <text class="empty-text">æš‚æ— å•†å“</text>
        <text class="empty-subtext">å»çœ‹çœ‹å…¶ä»–åˆ†ç±»å§~</text>
      </view>

      <!-- åˆ°åº•æç¤º -->
      <view class="load-more" wx:if="{{!loading && !hasMore && products.length > 0}}">
        <text>å·²ç»åˆ°åº•å•¦~</text>
      </view>
    </scroll-view>
  </view>
</view>
