<!-- è®¢å•è¯¦æƒ…é¡µ -->
<view class="container">
  <block wx:if="{{order}}">
    <!-- è®¢å•çŠ¶æ€è¿›åº¦ -->
    <view class="status-section">
      <view class="status-header">
        <text class="status-icon">{{statusIcon}}</text>
        <view class="status-info">
          <text class="status-text">{{order.statusText}}</text>
          <text class="status-desc" wx:if="{{statusDesc}}">{{statusDesc}}</text>
        </view>
      </view>
      
      <!-- è¿›åº¦æ¡ -->
      <view class="progress-bar" wx:if="{{order.status !== 4 && order.status !== 6}}">
        <view class="progress-item {{order.status >= 0 ? 'active' : ''}}">
          <view class="progress-dot"></view>
          <text class="progress-text">ä¸‹å•</text>
        </view>
        <view class="progress-line {{order.status >= 1 ? 'active' : ''}}"></view>
        <view class="progress-item {{order.status >= 1 ? 'active' : ''}}">
          <view class="progress-dot"></view>
          <text class="progress-text">ä»˜æ¬¾</text>
        </view>
        <view class="progress-line {{order.status >= 2 ? 'active' : ''}}"></view>
        <view class="progress-item {{order.status >= 2 ? 'active' : ''}}">
          <view class="progress-dot"></view>
          <text class="progress-text">å‘è´§</text>
        </view>
        <view class="progress-line {{order.status >= 3 ? 'active' : ''}}"></view>
        <view class="progress-item {{order.status >= 3 ? 'active' : ''}}">
          <view class="progress-dot"></view>
          <text class="progress-text">å®Œæˆ</text>
        </view>
      </view>
    </view>

    <!-- ç‰©æµä¿¡æ¯ï¼ˆå¾…æ”¶è´§çŠ¶æ€æ˜¾ç¤ºï¼‰ -->
    <view class="section logistics-section" wx:if="{{order.status === 2 && logistics}}">
      <view class="section-header" bindtap="viewLogistics">
        <view class="logistics-info">
          <text class="logistics-status">{{logistics.status}}</text>
          <text class="logistics-time">{{logistics.time}}</text>
        </view>
        <text class="arrow">></text>
      </view>
    </view>

    <!-- æ”¶è´§åœ°å€ -->
    <view class="section address-section">
      <view class="address-header">
        <text class="address-icon">ğŸ“</text>
        <text class="address-title">æ”¶è´§åœ°å€</text>
      </view>
      <view class="address-content">
        <view class="address-user">
          <text class="user-name">{{address.name}}</text>
          <text class="user-phone">{{address.phone}}</text>
        </view>
        <text class="address-detail">{{address.fullAddress}}</text>
      </view>
    </view>

    <!-- å•†å“æ¸…å• -->
    <view class="section goods-section">
      <view class="section-title">å•†å“æ¸…å•</view>
      <view class="goods-list">
        <view class="goods-item" wx:for="{{order.goodsList}}" wx:key="id">
          <image class="goods-image" src="{{item.image}}" mode="aspectFill"/>
          <view class="goods-info">
            <text class="goods-name">{{item.name}}</text>
            <text class="goods-spec" wx:if="{{item.spec}}">{{item.spec}}</text>
          </view>
          <view class="goods-price">
            <text class="price">Â¥{{item.price}}</text>
            <text class="count">x{{item.count}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ä»·æ ¼æ˜ç»† -->
    <view class="section price-section">
      <view class="price-item">
        <text class="price-label">å•†å“æ€»ä»·</text>
        <text class="price-value">Â¥{{order.goodsAmount}}</text>
      </view>
      <view class="price-item">
        <text class="price-label">è¿è´¹</text>
        <text class="price-value">Â¥{{order.freightAmount}}</text>
      </view>
      <view class="price-item" wx:if="{{order.discountAmount > 0}}">
        <text class="price-label">ä¼˜æƒ é‡‘é¢</text>
        <text class="price-value discount">-Â¥{{order.discountAmount}}</text>
      </view>
      <view class="price-item total">
        <text class="price-label">å®ä»˜é‡‘é¢</text>
        <text class="price-value total-value">Â¥{{order.totalAmount}}</text>
      </view>
    </view>

    <!-- è®¢å•ä¿¡æ¯ -->
    <view class="section info-section">
      <view class="section-title">è®¢å•ä¿¡æ¯</view>
      <view class="info-item">
        <text class="info-label">è®¢å•ç¼–å·</text>
        <view class="info-value">
          <text>{{order.orderNo}}</text>
          <text class="copy-btn" bindtap="copyOrderNo">å¤åˆ¶</text>
        </view>
      </view>
      <view class="info-item">
        <text class="info-label">ä¸‹å•æ—¶é—´</text>
        <text class="info-value">{{order.createTime}}</text>
      </view>
      <view class="info-item" wx:if="{{order.payTime}}">
        <text class="info-label">ä»˜æ¬¾æ—¶é—´</text>
        <text class="info-value">{{order.payTime}}</text>
      </view>
      <view class="info-item" wx:if="{{order.payType}}">
        <text class="info-label">æ”¯ä»˜æ–¹å¼</text>
        <text class="info-value">{{order.payType}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">é…é€æ–¹å¼</text>
        <text class="info-value">{{order.deliveryType || 'å¿«é€’é…é€'}}</text>
      </view>
      <view class="info-item" wx:if="{{order.remark}}">
        <text class="info-label">è®¢å•å¤‡æ³¨</text>
        <text class="info-value">{{order.remark}}</text>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="footer-actions">
      <!-- å¾…ä»˜æ¬¾ -->
      <block wx:if="{{order.status === 0}}">
        <button class="btn btn-default" bindtap="cancelOrder">å–æ¶ˆè®¢å•</button>
        <button class="btn btn-primary" bindtap="payOrder">ç«‹å³ä»˜æ¬¾</button>
      </block>
      
      <!-- å¾…å‘è´§ -->
      <block wx:if="{{order.status === 1}}">
        <button class="btn btn-default" bindtap="applyRefund">ç”³è¯·é€€æ¬¾</button>
        <button class="btn btn-default" bindtap="remindDelivery">æé†’å‘è´§</button>
      </block>
      
      <!-- å¾…æ”¶è´§ -->
      <block wx:if="{{order.status === 2}}">
        <button class="btn btn-default" bindtap="viewLogistics">æŸ¥çœ‹ç‰©æµ</button>
        <button class="btn btn-primary" bindtap="confirmReceive">ç¡®è®¤æ”¶è´§</button>
      </block>
      
      <!-- å·²å®Œæˆ -->
      <block wx:if="{{order.status === 3}}">
        <button class="btn btn-default" bindtap="deleteOrder">åˆ é™¤è®¢å•</button>
        <button class="btn btn-default" bindtap="buyAgain">å†æ¬¡è´­ä¹°</button>
        <button class="btn btn-primary" bindtap="goToReview" wx:if="{{!order.isReviewed}}">è¯„ä»·</button>
      </block>
      
      <!-- å·²å–æ¶ˆ/å·²é€€æ¬¾ -->
      <block wx:if="{{order.status === 4 || order.status === 6}}">
        <button class="btn btn-default" bindtap="deleteOrder">åˆ é™¤è®¢å•</button>
        <button class="btn btn-default" bindtap="buyAgain">å†æ¬¡è´­ä¹°</button>
      </block>
      
      <!-- é€€æ¬¾ä¸­ -->
      <block wx:if="{{order.status === 5}}">
        <button class="btn btn-default" bindtap="viewRefund">æŸ¥çœ‹é€€æ¬¾è¿›åº¦</button>
      </block>
    </view>
  </block>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-state" wx:elif="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:else>
    <image class="error-image" src="/images/error.png" mode="aspectFit"/>
    <text class="error-text">åŠ è½½å¤±è´¥</text>
    <button class="btn btn-primary" bindtap="reloadData">é‡æ–°åŠ è½½</button>
  </view>
</view>
