<!-- ç§¯åˆ†æ˜ç»†é¡µé¢ - æŒ‰ç…§ Figma è®¾è®¡ç¨¿å®ç° -->
<view class="points-history-page">

  <!-- ========== å›ºå®šå¤´éƒ¨åŒºåŸŸ ========== -->
  <view class="header-section">
    <!-- ç§¯åˆ†ä½™é¢å¡ç‰‡ -->
    <view class="points-card">
      <!-- è£…é¥°åœ†åœˆ -->
      <view class="deco-circle circle-1"></view>
      <view class="deco-circle circle-2"></view>

      <text class="points-label">å½“å‰ç§¯åˆ†</text>
      <view class="points-value-wrap">
        <text class="points-value">{{userPoints}}</text>
        <text class="points-unit">pt</text>
      </view>

      <!-- æœ¬æœˆç»Ÿè®¡ -->
      <view class="monthly-stats">
        <view class="stat-item">
          <text class="stat-icon stat-icon-up">â†—</text>
          <text class="stat-label">æœ¬æœˆè·å¾—</text>
          <text class="stat-value stat-value-up">+{{monthEarned}}</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-icon stat-icon-down">â†˜</text>
          <text class="stat-label">æœ¬æœˆæ¶ˆè´¹</text>
          <text class="stat-value stat-value-down">âˆ’{{monthSpent}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ========== å¯æ»šåŠ¨å†…å®¹åŒºåŸŸ ========== -->
  <scroll-view class="content-section" scroll-y enable-back-to-top>

    <!-- ç§¯åˆ†è¯´æ˜ -->
    <view class="notice-card notice-expiry">
      <text class="notice-icon">â“˜</text>
      <text class="notice-text">
        <text class="notice-highlight">1ç§¯åˆ†ç›¸å½“äºÂ¥1ï¼ŒæŠµç›¸åº”é‡‘é¢</text>
      </text>
      <text class="notice-action" bindtap="goToExchange">å»ä½¿ç”¨</text>
    </view>

    <!-- ç­›é€‰æ ‡ç­¾ -->
    <view class="filter-tabs">
      <view
        class="tab-item {{activeTab === 'all' ? 'tab-active' : ''}}"
        bindtap="onTabChange"
        data-tab="all"
      >
        <text>å…¨éƒ¨</text>
      </view>
      <view
        class="tab-item {{activeTab === 'earn' ? 'tab-active' : ''}}"
        bindtap="onTabChange"
        data-tab="earn"
      >
        <text>è·å¾—</text>
      </view>
      <view
        class="tab-item {{activeTab === 'spend' ? 'tab-active' : ''}}"
        bindtap="onTabChange"
        data-tab="spend"
      >
        <text>æ¶ˆè´¹</text>
      </view>
    </view>

    <!-- äº¤æ˜“åˆ—è¡¨ -->
    <view class="transaction-list" wx:if="{{!isLoading}}">
      <!-- æŒ‰æ—¥æœŸåˆ†ç»„ -->
      <block wx:for="{{groupedList}}" wx:key="date" wx:for-item="group">
        <view class="date-group">
          <!-- æ—¥æœŸæ ‡ç­¾ -->
          <view class="date-header">
            <text class="date-label">{{group.dateLabel}}</text>
            <view class="date-line"></view>
            <text class="date-subtotal">{{group.subtotal}}</text>
          </view>

          <!-- å½“æ—¥äº¤æ˜“å¡ç‰‡ -->
          <view class="transaction-card">
            <view
              class="transaction-item"
              wx:for="{{group.items}}"
              wx:key="_id"
              wx:for-index="itemIdx"
              style="border-bottom: {{itemIdx < group.items.length - 1 ? '1rpx solid #F5EDD8' : 'none'}}"
            >
              <!-- ç±»åˆ«å›¾æ ‡ -->
              <view class="tx-icon" style="background: {{item.bgColor}};">
                <text class="tx-icon-text" style="color: {{item.iconColor}};">{{item.icon}}</text>
              </view>

              <!-- äº¤æ˜“ä¿¡æ¯ -->
              <view class="tx-info">
                <text class="tx-title">{{item.label}}</text>
                <text class="tx-subtitle">{{item.desc || item.subtitle}}</text>
              </view>

              <!-- ç§¯åˆ†å’Œæ—¶é—´ -->
              <view class="tx-amount">
                <text class="tx-points {{item.type === 'earn' ? 'tx-earn' : 'tx-spend'}}">
                  {{item.type === 'earn' ? '+' : 'âˆ’'}}{{item.points > 0 ? item.points : -item.points}}
                </text>
                <text class="tx-time">{{item.time}}</text>
              </view>
            </view>
          </view>
        </view>
      </block>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{groupedList.length === 0}}">
        <text class="empty-icon">ğŸ“­</text>
        <text class="empty-text">æš‚æ— è®°å½•</text>
      </view>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view class="loading-state" wx:if="{{isLoading}}">
      <view class="loading-spinner"></view>
    </view>

    <!-- åº•éƒ¨æç¤º -->
    <view class="footer-hint">
      <view class="footer-line"></view>
      <text class="footer-text">ä»…æ˜¾ç¤ºæœ€è¿‘ 3 ä¸ªæœˆçš„è®°å½•</text>
      <view class="footer-line"></view>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view class="safe-area-bottom"></view>
  </scroll-view>

</view>
