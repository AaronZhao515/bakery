<!-- åœ°å€ç¼–è¾‘é¡µé¢ -->
<view class="address-edit-container">
  <!-- é®ç½©å±‚ -->
  <view class="page-mask" wx:if="{{showRegionPicker}}" bindtap="onCloseRegionPicker"></view>

  <!-- è¡¨å•å¼¹çª— -->
  <view class="form-sheet">
    <!-- æ‰‹æŸ„ + æ ‡é¢˜ -->
    <view class="sheet-header">
      <view class="sheet-handle"></view>
      <view class="sheet-title-wrap">
        <text class="sheet-title">{{mode === 'edit' ? 'ç¼–è¾‘åœ°å€' : 'æ–°å¢åœ°å€'}}</text>
        <view class="close-btn" bindtap="onBackTap">
          <text class="close-icon">âœ•</text>
        </view>
      </view>
      <view class="sheet-divider"></view>
    </view>

    <!-- è¡¨å•å†…å®¹ -->
    <scroll-view class="form-body" scroll-y>
      <!-- æ”¶è´§äºº -->
      <view class="form-item">
        <label class="form-label">
          æ”¶è´§äºº <text class="required">*</text>
        </label>
        <view class="input-wrap {{errors.name ? 'error' : ''}}">
          <text class="input-icon">ğŸ‘¤</text>
          <input
            class="form-input"
            type="text"
            value="{{form.name}}"
            placeholder="è¯·è¾“å…¥æ”¶è´§äººå§“å"
            data-field="name"
            bindinput="onInputChange"
          />
        </view>
        <text class="error-text" wx:if="{{errors.name}}">âš  {{errors.name}}</text>
      </view>

      <!-- æ‰‹æœºå· -->
      <view class="form-item">
        <label class="form-label">
          æ‰‹æœºå· <text class="required">*</text>
        </label>
        <view class="input-wrap {{errors.phone ? 'error' : ''}}">
          <text class="input-icon">ğŸ“±</text>
          <input
            class="form-input"
            type="number"
            value="{{form.phone}}"
            placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·"
            maxlength="11"
            data-field="phone"
            bindinput="onInputChange"
          />
        </view>
        <text class="error-text" wx:if="{{errors.phone}}">âš  {{errors.phone}}</text>
      </view>

      <!-- æ‰€åœ¨åœ°åŒº -->
      <view class="form-item">
        <label class="form-label">
          æ‰€åœ¨åœ°åŒº <text class="required">*</text>
        </label>
        <view class="input-wrap {{errors.province ? 'error' : ''}}" bindtap="onShowRegionPicker">
          <text class="input-icon">ğŸ“</text>
          <text class="region-text {{form.province ? '' : 'placeholder'}}">
            {{form.province ? form.province + ' ' + form.city + ' ' + form.district : 'è¯·é€‰æ‹©çœ/å¸‚/åŒº'}}
          </text>
          <text class="arrow-icon">â€º</text>
        </view>
        <text class="error-text" wx:if="{{errors.province}}">âš  {{errors.province}}</text>
      </view>

      <!-- è¯¦ç»†åœ°å€ -->
      <view class="form-item">
        <label class="form-label">
          è¯¦ç»†åœ°å€ <text class="required">*</text>
        </label>
        <view class="textarea-wrap {{errors.detail ? 'error' : ''}}">
          <textarea
            class="form-textarea"
            value="{{form.detail}}"
            placeholder="è¯·è¾“å…¥è¡—é“ã€æ¥¼å·ã€æˆ¿é—´å·ç­‰è¯¦ç»†ä¿¡æ¯"
            rows="3"
            data-field="detail"
            bindinput="onInputChange"
          />
        </view>
        <text class="error-text" wx:if="{{errors.detail}}">âš  {{errors.detail}}</text>
      </view>

      <!-- è®¾ä¸ºé»˜è®¤ -->
      <view class="form-item switch-item" bindtap="onDefaultToggle">
        <text class="form-label">è®¾ä¸ºé»˜è®¤åœ°å€</text>
        <view class="switch-wrap">
          <view class="custom-switch {{form.isDefault ? 'on' : ''}}">
            <view class="switch-thumb"></view>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- ä¿å­˜æŒ‰é’® -->
    <view class="form-footer">
      <view class="save-btn" bindtap="onSave">ä¿å­˜åœ°å€</view>
    </view>
  </view>

  <!-- åœ°åŒºé€‰æ‹©å™¨ï¼ˆå…¨å±ï¼‰ -->
  <view class="region-picker" wx:if="{{showRegionPicker}}">
    <!-- é€‰æ‹©å™¨å¤´éƒ¨ -->
    <view class="picker-header">
      <view class="picker-nav">
        <view class="back-btn" bindtap="onCloseRegionPicker">
          <image class="back-icon" src="{{icons.chevronLeft}}" mode="aspectFit"/>
        </view>
        <text class="picker-title">é€‰æ‹©åœ°åŒº</text>
        <view class="nav-placeholder"></view>
      </view>

      <!-- æ­¥éª¤æ ‡ç­¾ -->
      <view class="step-tabs">
        <view
          class="step-tab {{pickerStep === 'province' ? 'active' : ''}} {{pickerProvince ? '' : 'disabled'}}"
          data-step="province"
          bindtap="onSwitchStep"
        >
          <text class="step-label">çœ/ç›´è¾–å¸‚</text>
          <text class="step-value">{{pickerProvince || 'è¯·é€‰æ‹©'}}</text>
        </view>
        <view
          class="step-tab {{pickerStep === 'city' ? 'active' : ''}} {{pickerProvince ? '' : 'disabled'}}"
          data-step="city"
          bindtap="onSwitchStep"
        >
          <text class="step-label">åŸå¸‚</text>
          <text class="step-value">{{pickerCity || 'è¯·é€‰æ‹©'}}</text>
        </view>
        <view
          class="step-tab {{pickerStep === 'district' ? 'active' : ''}} {{pickerCity ? '' : 'disabled'}}"
          data-step="district"
          bindtap="onSwitchStep"
        >
          <text class="step-label">åŒº/å¿</text>
          <text class="step-value">{{pickerDistrict || 'è¯·é€‰æ‹©'}}</text>
        </view>
      </view>
    </view>

    <!-- åœ°åŒºåˆ—è¡¨ -->
    <scroll-view class="picker-body" scroll-y>
      <!-- çœä»½åˆ—è¡¨ -->
      <block wx:if="{{pickerStep === 'province'}}">
        <view
          class="region-item {{pickerProvince === item ? 'active' : ''}}"
          wx:for="{{['ä¸Šæµ·å¸‚','åŒ—äº¬å¸‚','å¹¿ä¸œçœ','æµ™æ±Ÿçœ','æ±Ÿè‹çœ']}}"
          wx:key="*this"
          data-province="{{item}}"
          bindtap="onSelectProvince"
        >
          <text class="region-name">{{item}}</text>
          <text class="check-icon" wx:if="{{pickerProvince === item}}">âœ“</text>
        </view>
      </block>

      <!-- åŸå¸‚åˆ—è¡¨ -->
      <block wx:if="{{pickerStep === 'city'}}">
        <view
          class="region-item {{pickerCity === item ? 'active' : ''}}"
          wx:for="{{cities}}"
          wx:key="*this"
          data-city="{{item}}"
          bindtap="onSelectCity"
        >
          <text class="region-name">{{item}}</text>
          <text class="check-icon" wx:if="{{pickerCity === item}}">âœ“</text>
        </view>
      </block>

      <!-- åŒºå¿åˆ—è¡¨ -->
      <block wx:if="{{pickerStep === 'district'}}">
        <view
          class="region-item {{pickerDistrict === item ? 'active' : ''}}"
          wx:for="{{districts}}"
          wx:key="*this"
          data-district="{{item}}"
          bindtap="onSelectDistrict"
        >
          <text class="region-name">{{item}}</text>
          <text class="check-icon" wx:if="{{pickerDistrict === item}}">âœ“</text>
        </view>
      </block>
    </scroll-view>
  </view>
</view>
