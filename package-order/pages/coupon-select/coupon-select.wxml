<!-- ä¼˜æƒ åˆ¸é€‰æ‹©é¡µé¢ -->
<view class="coupon-select-container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="header-bar">
    <view class="header-content">
      <view class="back-btn" bindtap="onBackTap">
        <image class="back-icon" src="{{icons.chevronLeft}}" mode="aspectFit"/>
      </view>
      <text class="header-title">é€‰æ‹©ä¼˜æƒ åˆ¸</text>
      <view class="header-right" bindtap="onConfirm">
        <text class="confirm-text">å®Œæˆ</text>
      </view>
    </view>
  </view>

  <!-- è®¢å•é‡‘é¢æç¤º -->
  <view class="amount-bar">
    <text class="amount-label">è®¢å•é‡‘é¢</text>
    <text class="amount-value">Â¥{{orderAmount}}</text>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¼˜æƒ åˆ¸åˆ—è¡¨ -->
  <scroll-view class="coupon-list" scroll-y wx:if="{{!isLoading}}">
    <!-- ä¸ä½¿ç”¨ä¼˜æƒ åˆ¸ -->
    <view class="no-coupon-option {{!selectedCoupon ? 'active' : ''}}" bindtap="onNotUseCoupon">
      <view class="option-info">
        <text class="option-text">ä¸ä½¿ç”¨ä¼˜æƒ åˆ¸</text>
        <text class="option-subtext">åŸä»·æ”¯ä»˜ï¼Œä¸äº«å—ä¼˜æƒ </text>
      </view>
      <view class="option-radio {{!selectedCoupon ? 'checked' : ''}}">
        <view class="radio-inner"></view>
      </view>
    </view>

    <!-- å¯ç”¨ä¼˜æƒ åˆ¸ -->
    <view class="coupon-section" wx:if="{{availableCoupons.length > 0}}">
      <view class="section-header">
        <text class="section-title">ğŸ’° å¯ç”¨ä¼˜æƒ åˆ¸ï¼ˆ{{availableCoupons.length}}å¼ ï¼‰</text>
      </view>
      <view class="coupon-option-list">
        <view class="coupon-option {{selectedCoupon.id === item.id ? 'selected' : ''}}"
               wx:for="{{availableCoupons}}"
               wx:key="id"
               data-id="{{item.id}}"
               bindtap="onSelectCoupon">
          <view class="option-left">
            <text class="option-value {{item.displayType}}">{{item.displayValue}}</text>
            <text class="option-condition">æ»¡{{item.minAmount}}å¯ç”¨</text>
          </view>
          <view class="option-right">
            <text class="option-title">{{item.title}}</text>
            <text class="option-desc">{{item.desc}}</text>
            <view class="option-tags">
              <text class="tag time">â± {{item.endTimeStr}}åˆ°æœŸ</text>
              <text class="tag discount" wx:if="{{selectedCoupon.id === item.id}}">çœÂ¥{{item.amount}}</text>
            </view>
          </view>
          <view class="option-radio {{selectedCoupon.id === item.id ? 'checked' : ''}}">
            <view class="radio-inner"></view>
          </view>
        </view>
      </view>
    </view>

    <!-- ä¸å¯ç”¨ä¼˜æƒ åˆ¸ -->
    <view class="coupon-section unavailable-section" wx:if="{{unavailableCoupons.length > 0}}">
      <view class="section-header">
        <text class="section-title">ğŸš« ä¸å¯ç”¨ä¼˜æƒ åˆ¸ï¼ˆ{{unavailableCoupons.length}}å¼ ï¼‰</text>
        <text class="section-subtitle">æœªè¾¾åˆ°ä½¿ç”¨æ¡ä»¶</text>
      </view>
      <view class="coupon-option-list">
        <view class="coupon-option disabled"
               wx:for="{{unavailableCoupons}}"
               wx:key="id"
               data-id="{{item.id}}"
               bindtap="goToCouponCenter">
          <view class="option-left gray">
            <text class="option-value {{item.displayType}}">{{item.displayValue}}</text>
            <text class="option-condition">æ»¡{{item.minAmount}}å¯ç”¨</text>
          </view>
          <view class="option-right">
            <text class="option-title">{{item.title}}</text>
            <text class="option-desc">{{item.desc}}</text>
            <view class="option-tags">
              <text class="tag time">â± {{item.endTimeStr}}åˆ°æœŸ</text>
              <text class="tag reason" wx:if="{{item.reason}}">âš  {{item.reason}}</text>
            </view>
          </view>
          <view class="option-arrow">></view>
        </view>
      </view>
    </view>

    <!-- æ— ä¼˜æƒ åˆ¸æç¤º -->
    <view class="empty-coupon" wx:if="{{availableCoupons.length === 0 && unavailableCoupons.length === 0}}">
      <view class="empty-icon-wrap">
        <text class="empty-icon">ğŸ«</text>
      </view>
      <text class="empty-text">æš‚æ— ä¼˜æƒ åˆ¸</text>
      <text class="empty-tip">å»ä¼˜æƒ åˆ¸ä¸­å¿ƒé¢†å–æ›´å¤šä¼˜æƒ </text>
      <view class="empty-btn" bindtap="goToCouponCenter">å»é¢†å–</view>
    </view>

    <!-- åº•éƒ¨é—´è· -->
    <view class="bottom-spacer"></view>
  </scroll-view>

  <!-- åº•éƒ¨ç¡®è®¤æ  -->
  <view class="confirm-bar" wx:if="{{!isLoading}}">
    <view class="confirm-info">
      <text class="confirm-label" wx:if="{{selectedCoupon}}">å·²é€‰ï¼š{{selectedCoupon.title}}</text>
      <text class="confirm-label" wx:else>æœªä½¿ç”¨ä¼˜æƒ åˆ¸</text>
      <text class="confirm-discount" wx:if="{{selectedCoupon}}">-Â¥{{selectedCoupon.amount}}</text>
    </view>
    <view class="confirm-btn" bindtap="onConfirm">ç¡®å®š</view>
  </view>
</view>
