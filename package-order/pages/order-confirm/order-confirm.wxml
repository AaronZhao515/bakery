<!-- è®¢å•ç¡®è®¤é¡µé¢ - é¢„å®šè®¢å•ï¼ˆåŒ¹é… Figma è®¾è®¡ç¨¿ï¼‰ -->
<view class="order-confirm-container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="header-bar">
    <view class="header-content">
      <view class="back-btn" bindtap="onBackTap">
        <image class="back-icon" src="{{icons.arrowLeft}}" mode="aspectFit"/>
        <text class="back-text">è¿”å›</text>
      </view>
      <text class="header-title">ç¡®è®¤è®¢å•</text>
      <view class="order-type-badge {{orderType === 'pickup' ? 'pickup' : 'delivery'}}">
        <image class="badge-icon" src="{{orderType === 'pickup' ? icons.storeFill : icons.truckFill}}" mode="aspectFit"/>
        <text>{{orderType === 'pickup' ? 'é¢„å®šè‡ªå–' : 'é¢„å®šé…é€'}}</text>
      </view>
    </view>
  </view>

  <!-- é¡µé¢å†…å®¹ -->
  <scroll-view class="page-content" scroll-y enhanced show-scrollbar="{{false}}" id="pageScroll">

    <!-- è‡ªå–/é…é€ä¿¡æ¯å¡ç‰‡ -->
    <view class="info-card">
      <view class="info-header">
        <view class="info-icon-wrap">
          <image class="info-icon" src="{{orderType === 'pickup' ? icons.storeFill : icons.truckFill}}" mode="aspectFit" />
        </view>
        <view class="info-title-wrap">
          <text class="info-title">{{orderType === 'pickup' ? 'åˆ°åº—è‡ªå–' : 'é…é€ä¸Šé—¨'}}</text>
          <text class="info-subtitle">{{orderType === 'pickup' ? 'é¢„è®¡15åˆ†é’Ÿå†…å¤‡å¥½' : 'é¢„è®¡30åˆ†é’Ÿå†…é€è¾¾'}}</text>
        </view>
      </view>

      <!-- è‡ªå–æ—¶é—´é€‰æ‹© -->
      <view class="time-selector" wx:if="{{orderType === 'pickup'}}" bindtap="onSelectTime">
        <text class="selector-label">å–é¤æ—¶é—´</text>
        <view class="selector-value">
          <text class="time-text">{{selectedTime || 'å°½å¿«å–é¤'}}</text>
          <image class="arrow-icon" src="{{icons.chevronRight}}" mode="aspectFit"/>
        </view>
      </view>

      <!-- é…é€åœ°å€é€‰æ‹© -->
      <view class="address-selector" wx:if="{{orderType === 'delivery'}}" bindtap="onSelectAddress"
      >
        <view class="address-content" wx:if="{{selectedAddress}}"
        >
          <view class="address-top"
          >
            <text class="address-name"
            >{{selectedAddress.name}}</text>
            <text class="address-phone"
            >{{selectedAddress.phone}}</text>
          </view>
          <text class="address-detail"
          >{{selectedAddress.address}}</text>
        </view>
        <view class="address-empty" wx:else
        >
          <text class="empty-text"
          >è¯·é€‰æ‹©é…é€åœ°å€</text>
        </view>
        <image class="arrow-icon" src="{{icons.chevronRight}}" mode="aspectFit"/>
      </view>
    </view>

    <!-- å•†å“åˆ—è¡¨å¡ç‰‡ -->
    <view class="products-card">
      <view class="card-header">
        <view class="shop-icon-wrap">
          <image class="shop-icon" src="{{icons.store}}" mode="aspectFit"/>
        </view>
        <text class="shop-name">æš–å¿ƒçƒ˜ç„™</text>
      </view>

      <view class="product-list">
        <view class="product-item" wx:for="{{orderItems}}" wx:key="id">
          <view class="product-image-wrap"
          >
            <image class="product-image" src="{{item.imageUrl || 'cloud://cloud1-5gh4dyhpb180b5fb.636c-cloud1-5gh4dyhpb180b5fb-1406006729/images/product-default.png'}}" mode="aspectFill" lazy-load/>
          </view>
          <view class="product-info"
          >
            <text class="product-name"
            >{{item.name}}</text>
            <text class="product-desc" wx:if="{{item.desc}}"
            >{{item.desc}}</text>
            <view class="product-bottom"
            >
              <text class="product-price"
              >Â¥{{item.price}}</text>
              <text class="product-qty"
              >x{{item.quantity}}</text>
            </view>
          </view>
          <text class="product-total"
          >Â¥{{item.price * item.quantity}}</text>
        </view>
      </view>

      <!-- å°è®¡ -->
      <view class="subtotal-row"
      >
        <text class="subtotal-label"
        >å…± {{totalQty}} ä»¶å•†å“ï¼Œå°è®¡</text>
        <text class="subtotal-price"
        >Â¥{{totalPrice}}</text>
      </view>
    </view>

    <!-- ä¼˜æƒ åˆ¸ -->
    <view class="coupon-row" bindtap="onSelectCoupon">
      <text class="row-label">ä¼˜æƒ åˆ¸</text>
      <view class="row-value">
        <block wx:if="{{selectedCoupon}}">
          <text class="coupon-text active">{{selectedCoupon.displayType === 'discount' ? selectedCoupon.displayValue + 'ä¼˜æƒ ' : '-Â¥' + selectedCoupon.amount}}</text>
        </block>
        <block wx:elif="{{availableCoupons.length > 0}}">
          <text class="coupon-text available">{{availableCoupons.length}}å¼ å¯ç”¨</text>
        </block>
        <block wx:else>
          <text class="coupon-text">æš‚æ— å¯ç”¨</text>
        </block>
        <image class="arrow-icon" src="{{icons.chevronRight}}" mode="aspectFit"/>
      </view>
    </view>

    <!-- å¤‡æ³¨ -->
    <view class="remark-row"
    >
      <text class="row-label"
      >è®¢å•å¤‡æ³¨</text>
      <input
        class="remark-input"
        placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆé€‰å¡«ï¼‰"
        placeholder-class="remark-placeholder"
        value="{{remark}}"
        bindinput="onRemarkInput"
      />
    </view>

    <!-- é…é€/è‡ªå–æç¤º -->
    <view class="order-note {{orderType}}"
    >
      <text class="note-icon"
      >{{orderType === 'pickup' ? 'ğŸª' : 'ğŸšš'}}</text>
      <view class="note-content"
      >
        <text class="note-title"
        >{{orderType === 'pickup' ? 'è‡ªå–æç¤º' : 'é…é€ä¿¡æ¯'}}</text>
        <text class="note-desc"
        >{{orderType === 'pickup' ? 'è¯·å‡­è®¢å•å·åˆ°åº—è‡ªå–ï¼Œè®¢å•ä¿ç•™2å°æ—¶' : 'æ»¡Â¥88å…é…é€è´¹ï¼Œé¢„è®¡30åˆ†é’Ÿå†…é€è¾¾'}}</text>
      </view>
    </view>

    <!-- åº•éƒ¨é—´è· -->
    <view class="bottom-spacer"></view>
  </scroll-view>


  <!-- åº•éƒ¨æäº¤æ  -->
  <view class="submit-bar"
  >
    <view class="submit-content"
    >
      <view class="price-wrap"
      >
        <text class="price-label"
        >åˆè®¡</text>
        <text class="price-symbol"
        >Â¥</text>
        <text class="price-value"
        >{{payPrice}}</text>
      </view>
      <button class="submit-btn {{isSubmitting ? 'submitting' : ''}}" bindtap="onSubmitOrder" disabled="{{isSubmitting}}"
      >
        {{isSubmitting ? 'æäº¤ä¸­...' : 'æäº¤è®¢å•'}}
      </button>
    </view>
  </view>
</view>

<!-- Toast æç¤º -->
<toast id="toast"></toast>
