<!-- è®¢å•è¯¦æƒ…é¡µé¢ - é¢„å®šè®¢å•è¯¦æƒ…ï¼ˆåŒ¹é… Figma è®¾è®¡ç¨¿ï¼‰ -->
<view class="order-detail-container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="header-bar">
    <view class="header-content">
      <view class="back-btn" bindtap="onBackTap">
        <image class="back-icon" src="{{icons.arrowLeft}}" mode="aspectFit"/>
        <text class="back-text">è¿”å›</text>
      </view>
      <text class="header-title">è®¢å•è¯¦æƒ…</text>
      <view class="header-right" bindtap="goToHome">
        <image class="home-icon" src="{{icons.home}}" mode="aspectFit"/>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-wrap" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é¡µé¢å†…å®¹ -->
  <scroll-view class="page-content" scroll-y enhanced show-scrollbar="{{false}}" wx:if="{{!isLoading && order}}">

    <!-- è®¢å•çŠ¶æ€å¡ç‰‡ -->
    <view class="status-card">
      <view class="status-header" style="background: {{order.statusInfo.bgColor}};">
        <text class="status-icon">{{order.statusInfo.icon}}</text>
        <view class="status-info">
          <text class="status-text" style="color: {{order.statusInfo.color}};">{{order.statusInfo.text}}</text>
          <text class="status-desc" wx:if="{{order.status === 0}}">è¯·åœ¨30åˆ†é’Ÿå†…å®Œæˆæ”¯ä»˜</text>
          <text class="status-desc" wx:if="{{order.status === 1}}">å•†å®¶å·²æ¥å•ï¼Œæ­£åœ¨å¤‡é¤ä¸­</text>
          <text class="status-desc" wx:if="{{order.status === 2}}">ç¾é£Ÿæ­£åœ¨åˆ¶ä½œä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…</text>
          <text class="status-desc" wx:if="{{order.status === 3}}">é…é€å‘˜æ­£åœ¨é…é€ä¸­</text>
          <text class="status-desc" wx:if="{{order.status === 4}}">è®¢å•å·²å®Œæˆï¼ŒæœŸå¾…æ‚¨çš„å†æ¬¡å…‰ä¸´</text>
          <text class="status-desc" wx:if="{{order.status === -1}}">è®¢å•å·²å–æ¶ˆ</text>
        </view>
      </view>

      <!-- çŠ¶æ€æµç¨‹ -->
      <view class="status-flow" wx:if="{{order.status >= 0 && order.status !== -1}}">
        <view class="flow-item {{order.status >= 0 ? 'active' : ''}}">
          <view class="flow-dot"></view>
          <text class="flow-text">æäº¤è®¢å•</text>
        </view>
        <view class="flow-line {{order.status >= 1 || order.status === 5 ? 'active' : ''}}"></view>
        <view class="flow-item {{order.status >= 1 || order.status === 5 ? 'active' : ''}}">
          <view class="flow-dot"></view>
          <text class="flow-text">{{order.status === 5 ? 'çº¿ä¸‹æ”¯ä»˜' : 'æ”¯ä»˜'}}</text>
        </view>
        <view class="flow-line {{order.status >= 2 ? 'active' : ''}}"></view>
        <view class="flow-item {{order.status >= 2 ? 'active' : ''}}">
          <view class="flow-dot"></view>
          <text class="flow-text">å•†å®¶æ‰“åŒ…</text>
        </view>
        <view class="flow-line {{order.status >= 4 ? 'active' : ''}}"></view>
        <view class="flow-item {{order.status >= 4 ? 'active' : ''}}">
          <view class="flow-dot"></view>
          <text class="flow-text">å®Œæˆ</text>
        </view>
      </view>
    </view>

    <!-- é…é€/è‡ªå–ä¿¡æ¯å¡ç‰‡ -->
    <view class="info-card">
      <view class="info-header">
        <view class="info-icon-wrap" style="background: {{order.deliveryType === 1 ? '#E8F4FD' : '#FFF8EE'}};">
          <text class="info-icon">{{order.deliveryType === 1 ? 'ğŸšš' : 'ğŸª'}}</text>
        </view>
        <view class="info-title-wrap">
          <text class="info-title">{{order.deliveryType === 1 ? 'é…é€ä¸Šé—¨' : 'åˆ°åº—è‡ªå–'}}</text>
          <text class="info-subtitle">{{order.deliveryType === 1 ? 'é¢„è®¡30åˆ†é’Ÿå†…é€è¾¾' : 'é¢„è®¡15åˆ†é’Ÿå†…å¤‡å¥½'}}</text>
        </view>
      </view>

      <!-- è‡ªå–ä¿¡æ¯ -->
      <view class="pickup-info" wx:if="{{order.deliveryType === 0}}">
        <view class="info-row">
          <text class="info-label">å–é¤æ—¶é—´</text>
          <text class="info-value">{{order.pickupTime || 'å°½å¿«å–é¤'}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">å–é¤åœ°å€</text>
          <text class="info-value">å°èµµé¢é£Ÿï¼ˆæš–å¿ƒè·¯123å·ï¼‰</text>
        </view>
      </view>

      <!-- é…é€ä¿¡æ¯ -->
      <view class="delivery-info" wx:if="{{order.deliveryType === 1 && order.address}}">
        <view class="info-row">
          <text class="info-label">æ”¶è´§äºº</text>
          <text class="info-value">{{order.address.name}} {{order.address.phone}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">æ”¶è´§åœ°å€</text>
          <text class="info-value">{{order.address.address}}</text>
        </view>
      </view>
    </view>

    <!-- å•†å“åˆ—è¡¨å¡ç‰‡ -->
    <view class="products-card">
      <view class="card-header">
        <view class="shop-icon-wrap">
          <image class="shop-icon" src="{{icons.store}}" mode="aspectFit"/>
        </view>
        <text class="shop-name">å°èµµé¢é£Ÿ</text>
      </view>

      <view class="product-list">
        <view class="product-item" wx:for="{{order.products}}" wx:key="productId">
          <view class="product-image-wrap">
            <image class="product-image" src="{{item.image || 'cloud://cloud1-5gh4dyhpb180b5fb.636c-cloud1-5gh4dyhpb180b5fb-1406006729/images/product-default.png'}}" mode="aspectFill" lazy-load/>
          </view>
          <view class="product-info">
            <text class="product-name">{{item.name}}</text>
            <text class="product-spec" wx:if="{{item.specName}}">{{item.specName}}</text>
            <view class="product-bottom">
              <text class="product-price">Â¥{{item.price}}</text>
              <text class="product-qty">x{{item.quantity}}</text>
            </view>
          </view>
          <text class="product-total">Â¥{{item.totalAmount}}</text>
        </view>
      </view>

      <!-- å°è®¡ -->
      <view class="subtotal-row">
        <text class="subtotal-label">å…± {{order.totalQty}} ä»¶å•†å“</text>
        <text class="subtotal-price">Â¥{{order.totalAmount}}</text>
      </view>
    </view>

    <!-- ä»·æ ¼æ˜ç»†å¡ç‰‡ -->
    <view class="price-card">
      <view class="price-row">
        <text class="price-label">å•†å“æ€»é¢</text>
        <text class="price-value">Â¥{{order.totalAmount}}</text>
      </view>
      <view class="price-row" wx:if="{{order.deliveryFee > 0}}">
        <text class="price-label">é…é€è´¹</text>
        <text class="price-value">Â¥{{order.deliveryFee}}</text>
      </view>
      <view class="price-row" wx:if="{{order.discountAmount > 0}}">
        <text class="price-label">ä¼˜æƒ é‡‘é¢</text>
        <text class="price-value discount">-Â¥{{order.discountAmount}}</text>
      </view>
      <view class="price-row total">
        <text class="price-label">å®ä»˜é‡‘é¢</text>
        <text class="price-value total">Â¥{{order.payAmount}}</text>
      </view>
    </view>

    <!-- è®¢å•ä¿¡æ¯å¡ç‰‡ -->
    <view class="order-info-card">
      <view class="info-title-row">
        <text class="section-title">è®¢å•ä¿¡æ¯</text>
      </view>
      <view class="info-row">
        <text class="info-label">è®¢å•ç¼–å·</text>
        <view class="info-value-wrap">
          <text class="info-value">{{order.orderNo}}</text>
          <text class="copy-btn" bindtap="onCopyOrderNo">å¤åˆ¶</text>
        </view>
      </view>
      <view class="info-row">
        <text class="info-label">ä¸‹å•æ—¶é—´</text>
        <text class="info-value">{{order.createTimeStr}}</text>
      </view>
      <view class="info-row" wx:if="{{order.payTimeStr}}">
        <text class="info-label">æ”¯ä»˜æ—¶é—´</text>
        <text class="info-value">{{order.payTimeStr}}</text>
      </view>
      <view class="info-row" wx:if="{{order.remark}}">
        <text class="info-label">è®¢å•å¤‡æ³¨</text>
        <text class="info-value">{{order.remark}}</text>
      </view>
    </view>

    <!-- å®¢æœå¡ç‰‡ -->
    <view class="service-card" bindtap="onContactService">
      <text class="service-icon">ğŸ’</text>
      <view class="service-content">
        <text class="service-title">é‡åˆ°é—®é¢˜ï¼Ÿ</text>
        <text class="service-desc">è”ç³»å®¢æœè·å–å¸®åŠ©</text>
      </view>
      <image class="arrow-icon" src="{{icons.chevronRight}}" mode="aspectFit"/>
    </view>

    <!-- åº•éƒ¨é—´è· -->
    <view class="bottom-spacer"></view>
  </scroll-view>

  <!-- åº•éƒ¨æ“ä½œæ  - å¾…æ”¯ä»˜çŠ¶æ€ï¼šæ˜¾ç¤ºå–æ¶ˆ+æ”¯ä»˜æŒ‰é’®ï¼›å·²æ”¯ä»˜æœªå®ŒæˆçŠ¶æ€ï¼šæ˜¾ç¤ºå–æ¶ˆæŒ‰é’® -->
  <view class="action-bar" wx:if="{{!isLoading && order && (order.canPay || order.canCancel)}}">
    <view class="action-content">
      <!-- å–æ¶ˆæŒ‰é’® - æ‰€æœ‰å¯å–æ¶ˆçŠ¶æ€éƒ½æ˜¾ç¤º -->
      <button class="action-btn secondary" bindtap="onCancelOrder">å–æ¶ˆè®¢å•</button>
      <!-- å¾…æ”¯ä»˜çŠ¶æ€æ˜¾ç¤ºæ”¯ä»˜æŒ‰é’® -->
      <block wx:if="{{order.canPay}}">
        <!-- ç§¯åˆ†è¶³å¤Ÿï¼šæ˜¾ç¤ºç§¯åˆ†æ”¯ä»˜æŒ‰é’® -->
        <button class="action-btn primary" bindtap="onPointsPay" wx:if="{{userPoints >= order.payAmount}}">
          ç§¯åˆ†æ”¯ä»˜ ({{userPoints}}pt)
        </button>
        <!-- ç§¯åˆ†ä¸å¤Ÿï¼šæ˜¾ç¤ºçº¿ä¸‹æ”¯ä»˜æŒ‰é’® -->
        <button class="action-btn offline" bindtap="onOfflinePay" wx:else>
          çº¿ä¸‹æ”¯ä»˜
        </button>
      </block>
    </view>
  </view>

  <!-- è‡ªå®šä¹‰ Tab Bar - æ”¯ä»˜å®Œæˆåæˆ–ä¸å¯å–æ¶ˆæ—¶æ˜¾ç¤º -->
  <view class="custom-tab-bar" wx:if="{{!isLoading && order && !order.canPay && !order.canCancel}}">
    <view
      class="tab-bar-item {{tabBarSelected === index ? 'tab-active' : ''}}"
      wx:for="{{tabBarList}}"
      wx:key="index"
      data-path="{{item.pagePath}}"
      data-index="{{index}}"
      bindtap="switchTab"
    >
      <view class="tab-icon-wrap">
        <image class="tab-icon-img" src="{{item.iconUrl}}" mode="aspectFit"/>
      </view>
      <text class="tab-text">{{item.text}}</text>
    </view>
  </view>
</view>
