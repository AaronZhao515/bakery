<!-- ç”¨æˆ·ç®¡ç†é¡µé¢ -->
<view class="user-manage-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-content">
      <text class="page-title">ç”¨æˆ·ç®¡ç†</text>
      <text class="page-subtitle">å…± {{total}} ä½ç”¨æˆ·</text>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-box {{searchFocus ? 'focus' : ''}}">
      <text class="search-icon">ğŸ”</text>
      <input
        class="search-input"
        type="text"
        placeholder="æœç´¢æ˜µç§°ã€æ‰‹æœºå·"
        value="{{keyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
        bindfocus="onSearchFocus"
        bindblur="onSearchBlur"
      />
      <view class="search-clear" wx:if="{{keyword}}" bindtap="clearSearch">
        <text>Ã—</text>
      </view>
    </view>
    <view class="add-btn" bindtap="showAddUser">
      <text class="add-icon">+</text>
      <text class="add-text">æ·»åŠ </text>
    </view>
  </view>

  <!-- è§’è‰²ç­›é€‰ -->
  <view class="role-filter-section">
    <scroll-view class="role-scroll" scroll-x enable-flex>
      <view class="role-list">
        <view
          class="role-item {{currentRole === item.value ? 'active' : ''}}"
          wx:for="{{roleOptions}}"
          wx:key="value"
          data-role="{{item.value}}"
          bindtap="switchRoleFilter"
        >
          {{item.name}}
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- çŠ¶æ€ç­›é€‰ -->
  <view class="role-filter-section">
    <scroll-view class="role-scroll" scroll-x enable-flex>
      <view class="role-list">
        <view
          class="role-item {{currentStatus === item.value ? 'active' : ''}}"
          wx:for="{{statusOptions}}"
          wx:key="value"
          data-status="{{item.value}}"
          bindtap="switchStatusFilter"
        >
          {{item.name}}
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ç”¨æˆ·åˆ—è¡¨ -->
  <view class="user-list">
    <view
      class="user-card"
      wx:for="{{users}}"
      wx:key="_id"
      data-id="{{item._id}}"
      bindtap="showEditUser"
    >
      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="user-main">
        <image class="user-avatar {{item.status === 'disabled' ? 'disabled' : ''}}" src="{{item.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"/>
        <view class="user-info">
          <view class="user-name-row">
            <text class="user-name {{item.status === 'disabled' ? 'disabled' : ''}}">{{item.nickName || 'æœªè®¾ç½®æ˜µç§°'}}</text>
            <view class="role-tag {{item.isAdmin === true ? 'admin' : 'user'}}">
              {{item.isAdmin === true ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'}}
            </view>
            <view class="status-tag {{item.status === 'active' ? 'active' : 'disabled'}}">
              {{item.status === 'active' ? 'æ­£å¸¸' : 'å·²ç¦ç”¨'}}
            </view>
          </view>
          <text class="user-phone">{{item.phone || 'æœªç»‘å®šæ‰‹æœº'}}</text>
          <view class="user-stats-row">
            <text class="user-stat">ç§¯åˆ†: {{item.points || 0}}</text>
            <text class="user-stat-dot">Â·</text>
            <text class="user-stat">ä½™é¢: Â¥{{item.balance || 0}}</text>
          </view>
          <text class="user-time">æ³¨å†Œ: {{item.createTime}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="user-actions" catchtap="preventBubble">
        <button
          class="action-btn secondary"
          catchtap="makePhoneCall"
          data-phone="{{item.phone}}"
          disabled="{{!item.phone}}"
        >
          æ‹¨æ‰“ç”µè¯
        </button>
        <button
          class="action-btn {{item.status === 'disabled' ? 'success' : 'warning'}}"
          catchtap="toggleUserStatus"
          data-id="{{item._id}}"
          data-status="{{item.status}}"
          data-name="{{item.nickName}}"
        >
          {{item.status === 'disabled' ? 'å¯ç”¨' : 'ç¦ç”¨'}}
        </button>
        <button
          class="action-btn primary"
          catchtap="showEditUser"
          data-id="{{item._id}}"
        >
          ç¼–è¾‘
        </button>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{users.length === 0 && !isLoading}}">
      <text class="empty-icon">ğŸ‘¥</text>
      <text class="empty-text">æš‚æ— ç”¨æˆ·æ•°æ®</text>
      <text class="empty-subtext">{{keyword ? 'æ¢ä¸ªå…³é”®è¯è¯•è¯•' : 'ç”¨æˆ·å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ'}}</text>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{users.length > 0}}">
    <text wx:if="{{isLoading}}">åŠ è½½ä¸­...</text>
    <text wx:elif="{{hasMore}}">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
    <text wx:else>æ²¡æœ‰æ›´å¤šç”¨æˆ·äº†</text>
  </view>
</view>
