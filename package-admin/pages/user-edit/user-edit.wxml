<!-- ç”¨æˆ·ç¼–è¾‘/æ·»åŠ é¡µé¢ -->
<view class="user-edit-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-content">
      <text class="page-title">{{isEdit ? 'ç¼–è¾‘ç”¨æˆ·' : 'æ·»åŠ ç”¨æˆ·'}}</text>
      <text class="page-subtitle">{{isEdit ? 'ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯' : 'åˆ›å»ºæ–°ç”¨æˆ·è´¦å·'}}</text>
    </view>
  </view>

  <!-- å¯æ»šåŠ¨å†…å®¹åŒº -->
  <scroll-view class="scrollable-content" scroll-y>
    <!-- è¡¨å•å†…å®¹ -->
    <view class="form-section">
    <!-- å¤´åƒä¸Šä¼  -->
    <view class="form-item avatar-item">
      <text class="form-label">ç”¨æˆ·å¤´åƒ</text>
      <view class="avatar-upload" bindtap="chooseAvatar">
        <image wx:if="{{formData.avatarUrl}}" class="avatar-preview" src="{{formData.avatarUrl}}" mode="aspectFill"/>
        <view wx:else class="avatar-placeholder">
          <text class="avatar-icon">ğŸ“·</text>
          <text class="avatar-text">ç‚¹å‡»ä¸Šä¼ </text>
        </view>
        <view class="avatar-edit-badge">
          <text>æ›´æ¢</text>
        </view>
      </view>
    </view>

    <!-- æ˜µç§° -->
    <view class="form-item">
      <text class="form-label">
        æ˜µç§°
        <text class="required">*</text>
      </text>
      <input
        class="form-input"
        type="text"
        placeholder="è¯·è¾“å…¥ç”¨æˆ·æ˜µç§°"
        value="{{formData.nickName}}"
        bindinput="onInput"
        data-field="nickName"
      />
    </view>

    <!-- æ‰‹æœºå· -->
    <view class="form-item">
      <text class="form-label">
        æ‰‹æœºå·
        <text class="required">*</text>
      </text>
      <input
        class="form-input"
        type="number"
        placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·"
        value="{{formData.phone}}"
        bindinput="onInput"
        data-field="phone"
        maxlength="11"
      />
    </view>

    <!-- ä¼šå‘˜ç­‰çº§ -->
    <view class="form-item">
      <text class="form-label">ä¼šå‘˜ç­‰çº§</text>
      <picker mode="selector" range="{{memberLevels}}" range-key="name" value="{{formData.memberLevel}}" bindchange="onMemberLevelChange">
        <view class="form-picker">
          <text class="picker-text">{{memberLevels[formData.memberLevel].name}}</text>
          <text class="picker-arrow">â€º</text>
        </view>
      </picker>
    </view>

    <!-- ç§¯åˆ† -->
    <view class="form-item">
      <text class="form-label">ç§¯åˆ†</text>
      <input
        class="form-input"
        type="number"
        placeholder="è¯·è¾“å…¥ç§¯åˆ†"
        value="{{formData.points}}"
        bindinput="onNumberInput"
        data-field="points"
      />
    </view>

    <!-- ä½™é¢ -->
    <view class="form-item">
      <text class="form-label">ä½™é¢ (Â¥)</text>
      <input
        class="form-input"
        type="digit"
        placeholder="è¯·è¾“å…¥ä½™é¢"
        value="{{formData.balance}}"
        bindinput="onNumberInput"
        data-field="balance"
      />
    </view>

    <!-- ç®¡ç†å‘˜å¼€å…³ -->
    <view class="form-item switch-item">
      <view class="switch-info">
        <text class="form-label">è®¾ä¸ºç®¡ç†å‘˜</text>
        <text class="switch-hint">å¼€å¯åè¯¥ç”¨æˆ·æ‹¥æœ‰ç®¡ç†æƒé™</text>
      </view>
      <switch
        class="admin-switch"
        checked="{{formData.isAdmin}}"
        bindchange="onSwitchChange"
        color="#8B6347"
      />
    </view>

    <!-- ç”¨æˆ·çŠ¶æ€ï¼ˆä»…ç¼–è¾‘æ—¶æ˜¾ç¤ºï¼‰ -->
    <view class="form-item switch-item" wx:if="{{isEdit}}">
      <view class="switch-info">
        <text class="form-label">ç”¨æˆ·çŠ¶æ€</text>
        <text class="switch-hint">{{formData.status === 'active' ? 'ç”¨æˆ·å¯æ­£å¸¸ç™»å½•å’Œä½¿ç”¨' : 'ç”¨æˆ·å·²è¢«ç¦ç”¨ï¼Œæ— æ³•ç™»å½•'}}</text>
      </view>
      <view class="status-toggle {{formData.status === 'active' ? 'active' : 'disabled'}}" bindtap="toggleUserStatus">
        <text class="status-text">{{formData.status === 'active' ? 'æ­£å¸¸' : 'å·²ç¦ç”¨'}}</text>
        <switch checked="{{formData.status === 'active'}}" color="#8B6347" disabled/>
      </view>
    </view>

    <!-- ç¦ç”¨/å¯ç”¨æŒ‰é’®ï¼ˆä»…ç¼–è¾‘æ—¶æ˜¾ç¤ºï¼‰ -->
    <view class="form-item delete-item" wx:if="{{isEdit}}">
      <view class="delete-btn {{formData.status === 'disabled' ? 'enable' : 'disable'}}" bindtap="toggleUserStatus">
        <text class="delete-icon">{{formData.status === 'disabled' ? 'âœ“' : 'âœ•'}}</text>
        <text class="delete-text">{{formData.status === 'disabled' ? 'å¯ç”¨è¯¥ç”¨æˆ·' : 'ç¦ç”¨è¯¥ç”¨æˆ·'}}</text>
      </view>
    </view>
  </view>

    <!-- åº•éƒ¨å ä½ -->
    <view class="bottom-spacer"></view>
  </scroll-view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="footer">
    <button class="footer-btn secondary" bindtap="goBack">å–æ¶ˆ</button>
    <button class="footer-btn primary" bindtap="saveUser">ä¿å­˜</button>
  </view>

  <!-- å¯ç”¨è¢«ç¦ç”¨ç”¨æˆ·ç¡®è®¤å¼¹çª— -->
  <view class="confirm-modal {{showEnableConfirm ? 'show' : ''}}" wx:if="{{showEnableConfirm}}">
    <view class="modal-mask" bindtap="hideEnableConfirm"></view>
    <view class="modal-content">
      <view class="confirm-header">
        <view class="confirm-icon" style="background: #E8F5E9; color: #4CAF50;">ğŸ’¡</view>
        <text class="confirm-title">ç”¨æˆ·å·²å­˜åœ¨</text>
      </view>
      <view class="confirm-body">
        <text class="confirm-text">æ‰‹æœºå· {{pendingFormData.phone}} å·²è¢«æ³¨å†Œ</text>
        <text class="confirm-subtext">ç”¨æˆ·ã€Œ{{enableConfirmData.nickName || 'æœªå‘½åç”¨æˆ·'}}ã€å½“å‰å¤„äº<text style="color: #E57373; font-weight: 600;">ç¦ç”¨çŠ¶æ€</text></text>
        <text class="confirm-hint">æ˜¯å¦å¯ç”¨è¯¥ç”¨æˆ·å¹¶æ›´æ–°ä¿¡æ¯ï¼Ÿ</text>
      </view>
      <view class="confirm-footer">
        <button class="confirm-btn secondary" bindtap="hideEnableConfirm">å–æ¶ˆ</button>
        <button class="confirm-btn primary" bindtap="confirmEnableUser">å¯ç”¨å¹¶æ›´æ–°</button>
      </view>
    </view>
  </view>
</view>
