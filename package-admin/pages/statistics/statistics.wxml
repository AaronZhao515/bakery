<!-- æ•°æ®ç»Ÿè®¡é¡µé¢ -->
<view class="statistics-container">
  <!-- åŠ è½½é”™è¯¯çŠ¶æ€ -->
  <view class="load-error" wx:if="{{loadError}}">
    <text class="empty-icon">âš ï¸</text>
    <text class="empty-text">åŠ è½½å¤±è´¥</text>
    <text class="empty-subtext">è¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•</text>
    <button class="retry-btn" bindtap="retryLoad">é‡æ–°åŠ è½½</button>
  </view>

  <!-- æ­£å¸¸å†…å®¹ -->
  <block wx:if="{{!loadError}}">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">é”€å”®æ•°æ®ç»Ÿè®¡</text>
    <text class="page-subtitle">å¤šç»´åº¦ç»è¥æ•°æ®åˆ†æ</text>
  </view>

  <!-- é¡¶éƒ¨æ±‡æ€»å¡ç‰‡ -->
  <view class="summary-cards">
    <view class="summary-card today">
      <view class="card-icon">ğŸ“Š</view>
      <view class="card-content">
        <text class="card-label">ä»Šæ—¥é”€å”®</text>
        <text class="card-value">Â¥{{statistics.today.salesAmount}}</text>
        <text class="card-compare {{statistics.today.salesAmount >= statistics.yesterday.salesAmount ? 'up' : 'down'}}">
          è¾ƒæ˜¨æ—¥ {{statistics.today.salesAmount >= statistics.yesterday.salesAmount ? '+' : ''}}{{todayComparePercent}}%
        </text>
      </view>
    </view>

    <view class="summary-card week">
      <view class="card-icon">ğŸ“ˆ</view>
      <view class="card-content">
        <text class="card-label">æœ¬å‘¨é”€å”®</text>
        <text class="card-value">Â¥{{statistics.week.salesAmount}}</text>
        <text class="card-compare">{{statistics.week.orderCount}} å•</text>
      </view>
    </view>

    <view class="summary-card month">
      <view class="card-icon">ğŸ“…</view>
      <view class="card-content">
        <text class="card-label">æœ¬æœˆé”€å”®</text>
        <text class="card-value">Â¥{{statistics.month.salesAmount}}</text>
        <text class="card-compare">{{statistics.month.orderCount}} å•</text>
      </view>
    </view>

    <view class="summary-card year">
      <view class="card-icon">ğŸ†</view>
      <view class="card-content">
        <text class="card-label">å¹´åº¦é”€å”®</text>
        <text class="card-value">Â¥{{statistics.year.salesAmount}}</text>
        <text class="card-compare">{{statistics.year.orderCount}} å•</text>
      </view>
    </view>
  </view>

  <!-- è¶‹åŠ¿åˆ†æ -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">é”€å”®è¶‹åŠ¿</text>
      <view class="period-tabs">
        <view class="tab {{trendPeriod === 'week' ? 'active' : ''}}" bindtap="switchTrendPeriod" data-period="week">æœ¬å‘¨</view>
        <view class="tab {{trendPeriod === 'month' ? 'active' : ''}}" bindtap="switchTrendPeriod" data-period="month">æœ¬æœˆ</view>
        <view class="tab {{trendPeriod === 'year' ? 'active' : ''}}" bindtap="switchTrendPeriod" data-period="year">å…¨å¹´</view>
      </view>
    </view>

    <!-- è¶‹åŠ¿å›¾è¡¨åŒºåŸŸ -->
    <view class="chart-container">
      <view class="chart-placeholder" wx:if="{{hasTrendData}}">
        <view class="trend-bars">
          <view class="trend-bar-item" wx:for="{{trendData}}" wx:key="index">
            <view class="bar-wrapper">
              <view class="bar" style="height: {{item.percent}}%; background: {{item.color}};"></view>
            </view>
            <text class="bar-label">{{item.label}}</text>
            <text class="bar-value">Â¥{{item.value}}</text>
          </view>
        </view>
      </view>
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{!hasTrendData && !isLoading}}">
        <text class="empty-icon">ğŸ“Š</text>
        <text class="empty-text">æš‚æ— è¶‹åŠ¿æ•°æ®</text>
        <text class="empty-subtext">è¯¥æ—¶æ®µæš‚æœªæœ‰é”€å”®è®°å½•</text>
      </view>
    </view>

    <!-- è¶‹åŠ¿ç»Ÿè®¡ -->
    <view class="trend-stats">
      <view class="trend-stat-item">
        <text class="stat-label">æœ€é«˜é”€å”®é¢</text>
        <text class="stat-value">Â¥{{trendStats.maxAmount}}</text>
      </view>
      <view class="trend-stat-item">
        <text class="stat-label">å¹³å‡é”€å”®é¢</text>
        <text class="stat-value">Â¥{{trendStats.avgAmount}}</text>
      </view>
      <view class="trend-stat-item">
        <text class="stat-label">æ€»è®¢å•æ•°</text>
        <text class="stat-value">{{trendStats.totalOrders}} å•</text>
      </view>
    </view>
  </view>

  <!-- æ—¶æ®µåˆ†æ -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">æ—¶æ®µåˆ†æ</text>
      <text class="section-subtitle">ä»Šæ—¥å„æ—¶æ®µé”€å”®åˆ†å¸ƒ</text>
    </view>

    <view class="time-analysis" wx:if="{{hasTimeData}}">
      <view class="time-slot" wx:for="{{timeSlots}}" wx:key="time">
        <view class="time-label">{{item.time}}</view>
        <view class="time-bar-wrapper">
          <view class="time-bar" style="width: {{item.percent}}%;"></view>
        </view>
        <view class="time-value">Â¥{{item.amount}}</view>
        <view class="time-orders">{{item.orders}}å•</view>
      </view>
    </view>
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state small" wx:if="{{!hasTimeData && !isLoading}}">
      <text class="empty-text">ä»Šæ—¥æš‚æ— æ—¶æ®µæ—¶é—´åˆ†å¸ƒæ•°æ®</text>
    </view>
  </view>

  <!-- å•†å“é”€å”®æ’è¡Œ -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">çƒ­é”€å•†å“ TOP10</text>
      <view class="rank-tabs">
        <view class="tab {{rankPeriod === 'today' ? 'active' : ''}}" bindtap="switchRankPeriod" data-period="today">ä»Šæ—¥</view>
        <view class="tab {{rankPeriod === 'week' ? 'active' : ''}}" bindtap="switchRankPeriod" data-period="week">æœ¬å‘¨</view>
        <view class="tab {{rankPeriod === 'month' ? 'active' : ''}}" bindtap="switchRankPeriod" data-period="month">æœ¬æœˆ</view>
      </view>
    </view>

    <view class="product-rank-list" wx:if="{{hasRankingData}}">
      <view class="rank-header">
        <text class="col-rank">æ’å</text>
        <text class="col-product">å•†å“</text>
        <text class="col-sales">é”€é‡</text>
        <text class="col-amount">é”€å”®é¢</text>
      </view>
      <view class="rank-item {{index < 3 ? 'top' + (index + 1) : ''}}" wx:for="{{productRanking}}" wx:key="productId">
        <view class="col-rank">
          <text class="rank-num">{{index + 1}}</text>
        </view>
        <view class="col-product">
          <image class="product-thumb" src="{{item.image || '/images/default-product.png'}}" mode="aspectFill"></image>
          <text class="product-name">{{item.name}}</text>
        </view>
        <text class="col-sales">{{item.salesCount}}</text>
        <text class="col-amount">Â¥{{item.salesAmount}}</text>
      </view>
    </view>
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!hasRankingData && !isLoading}}">
      <text class="empty-icon">ğŸ†</text>
      <text class="empty-text">æš‚æ— å•†å“é”€å”®æ•°æ®</text>
      <text class="empty-subtext">{{rankPeriod === 'today' ? 'ä»Šæ—¥æš‚æœªæœ‰å•†å“é”€å”®' : rankPeriod === 'week' ? 'æœ¬å‘¨æš‚æœªæœ‰å•†å“é”€å”®' : 'æœ¬æœˆæš‚æœªæœ‰å•†å“é”€å”®'}}</text>
    </view>
  </view>

  <!-- æ•°æ®æ´å¯Ÿ -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">æ•°æ®æ´å¯Ÿ</text>
    </view>

    <view class="insights-cards">
      <view class="insight-card">
        <view class="insight-icon">ğŸ’¡</view>
        <view class="insight-content">
          <text class="insight-title">å®¢å•ä»·åˆ†æ</text>
          <text class="insight-value">Â¥{{insights.avgOrderAmount}}</text>
          <text class="insight-desc">å¹³å‡æ¯å•é‡‘é¢</text>
        </view>
      </view>

      <view class="insight-card">
        <view class="insight-icon">ğŸ¯</view>
        <view class="insight-content">
          <text class="insight-title">è½¬åŒ–ç‡</text>
          <text class="insight-value">{{insights.conversionRate}}%</text>
          <text class="insight-desc">æµè§ˆåˆ°ä¸‹å•æ¯”ä¾‹</text>
        </view>
      </view>

      <view class="insight-card">
        <view class="insight-icon">â°</view>
        <view class="insight-content">
          <text class="insight-title">é«˜å³°æ—¶æ®µ</text>
          <text class="insight-value">{{insights.peakHour}}</text>
          <text class="insight-desc">è®¢å•æœ€å¤šæ—¶æ®µ</text>
        </view>
      </view>

      <view class="insight-card">
        <view class="insight-icon">ğŸ”„</view>
        <view class="insight-content">
          <text class="insight-title">å¤è´­ç‡</text>
          <text class="insight-value">{{insights.repurchaseRate}}%</text>
          <text class="insight-desc">å›å¤´å®¢å æ¯”</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area-bottom"></view>
  </block>
</view>
